var Base=function(){};Base.extend=function(b,e){var f=Base.prototype.extend;Base._prototyping=true;var d=new this;f.call(d,b);d.base=function(){};delete Base._prototyping;var c=d.constructor;var a=d.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==a){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||f).call(arguments[0],d)}}}};a.ancestor=this;a.extend=this.extend;a.forEach=this.forEach;a.implement=this.implement;a.prototype=d;a.toString=this.toString;a.valueOf=function(g){return(g=="object")?a:c.valueOf()};f.call(a,e);if(typeof a.init=="function"){a.init()}return a};Base.prototype={extend:function(b,h){if(arguments.length>1){var e=this[b];if(e&&(typeof h=="function")&&(!e.valueOf||e.valueOf()!=h.valueOf())&&/\bbase\b/.test(h)){var a=h.valueOf();h=function(){var k=this.base||Base.prototype.base;this.base=e;var i=a.apply(this,arguments);this.base=k;return i};h.valueOf=function(i){return(i=="object")?h:a};h.toString=Base.toString}this[b]=h}else{if(b){var g=Base.prototype.extend;if(!Base._prototyping&&typeof this!="function"){g=this.extend||g}var d={toSource:null};var f=["constructor","toString","valueOf"];var c=Base._prototyping?0:1;while(j=f[c++]){if(b[j]!=d[j]){g.call(this,j,b[j])}}for(var j in b){if(!d[j]){g.call(this,j,b[j])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,d,c){for(var b in a){if(this.prototype[b]===undefined){d.call(c,a[b],b,a)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]=="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});(function(a){Validator={validate:function(b,c){return Validator._validate(b,c,{changing:false})},checkPropertyChange:function(d,b,c){return Validator._validate(d,b,{changing:c||"property"})},_validate:function(c,g,d){if(!d){d={}}var b=d.changing;var h=[];function f(r,n,v,p){var m;v+=v?typeof p=="number"?"["+p+"]":typeof p=="undefined"?"":"."+p:p;function w(i){h.push({property:v,message:i})}if((typeof n!="object"||n instanceof Array)&&(v||typeof n!="function")&&!(n&&n.type)){if(typeof n=="function"){if(!(r instanceof n)){w("is not an instance of the class/constructor "+n.name)}}else{if(n){w("Invalid schema/property definition "+n)}}return null}if(b&&n.readonly){w("is a readonly field, it can not be changed")}if(n["extends"]){f(r,n["extends"],v,p)}function k(A,B){if(A){if(typeof A=="string"&&A!="any"&&(A=="null"?B!==null:typeof B!=A)&&!(B instanceof Array&&A=="array")&&!(B instanceof Date&&A=="date")&&!(A=="integer"&&B%1===0)){return[{property:v,message:(typeof B)+" value found, but a "+A+" is required"}]}if(A instanceof Array){var z=[];for(var y=0;y<A.length;y++){if(!(z=k(A[y],B)).length){break}}if(z.length){return z}}else{if(typeof A=="object"){var i=h;h=[];f(B,A,v);var l=h;h=i;return l}}}return[]}if(r===undefined){if(n.required){w("is missing and it is required")}}else{h=h.concat(k(n.type,r));if(n.disallow&&!k(n.disallow,r).length){w(" disallowed value was matched")}if(r!==null){if(r instanceof Array){if(n.items){var s=n.items instanceof Array;var u=n.items;for(p=0,m=r.length;p<m;p+=1){if(s){u=n.items[p]}if(d.coerce){r[p]=d.coerce(r[p],u)}h.concat(f(r[p],u,v,p))}}if(n.minItems&&r.length<n.minItems){w("There must be a minimum of "+n.minItems+" in the array")}if(n.maxItems&&r.length>n.maxItems){w("There must be a maximum of "+n.maxItems+" in the array")}}else{if(n.properties||n.additionalProperties){h.concat(e(r,n.properties,v,n.additionalProperties))}}if(n.pattern&&typeof r=="string"&&!r.match(n.pattern)){w("does not match the regex pattern "+n.pattern)}if(n.maxLength&&typeof r=="string"&&r.length>n.maxLength){w("may only be "+n.maxLength+" characters long")}if(n.minLength&&typeof r=="string"&&r.length<n.minLength){w("must be at least "+n.minLength+" characters long")}if(typeof n.minimum!==undefined&&typeof r==typeof n.minimum&&n.minimum>r){w("must have a minimum value of "+n.minimum)}if(typeof n.maximum!==undefined&&typeof r==typeof n.maximum&&n.maximum<r){w("must have a maximum value of "+n.maximum)}if(n["enum"]){var q=n["enum"];m=q.length;var t;for(var o=0;o<m;o++){if(q[o]===r){t=1;break}}if(!t){w("does not have a value in the enumeration "+q.join(", "))}}if(typeof n.maxDecimal=="number"&&(r.toString().match(new RegExp("\\.[0-9]{"+(n.maxDecimal+1)+",}")))){w("may only have "+n.maxDecimal+" digits of decimal places")}}}return null}function e(j,k,p,o){if(typeof k=="object"){if(typeof j!="object"||j instanceof Array){h.push({property:p,message:"an object is required"})}for(var l in k){if(k.hasOwnProperty(l)){var n=j[l];if(n===undefined&&d.existingOnly){continue}var q=k[l];if(n===undefined&&q["default"]){n=j[l]=q["default"]}if(d.coerce&&l in j){n=j[l]=d.coerce(n,q)}f(n,q,p,l)}}}for(l in j){if(j.hasOwnProperty(l)&&!(l.charAt(0)=="_"&&l.charAt(1)=="_")&&k&&!k[l]&&o===false){if(d.filter){delete j[l];continue}else{h.push({property:p,message:(typeof n)+"The property "+l+" is not defined in the schema and the schema does not allow additional properties"})}}var m=k&&k[l]&&k[l].requires;if(m&&!(m in j)){h.push({property:p,message:"the presence of the property "+l+" requires that "+m+" also be present"})}n=j[l];if(o&&(!(k&&typeof k=="object")||!(l in k))){if(d.coerce){n=j[l]=d.coerce(n,o)}f(n,o,p,l)}if(!b&&n&&n.$schema){h=h.concat(f(n,n.$schema,p,l))}}return h}if(g){f(c,g,"",b||"")}if(!b&&c&&c.$schema){f(c,c.$schema,"","")}return{valid:!h.length,errors:h}},mustBeValid:function(b){if(!b.valid){throw new TypeError(b.errors.map(function(c){return"for property "+c.property+": "+c.message}).join(", \n"))}}};String.type="string";Boolean.type="boolean";Number.type="number";Integer={type:"integer"};Object.type="object";Array.type="array";Date.type="date";a.validator=window.Validator=Validator})(jQuery);(function(i,f){var t=i.fn.domManip,h="_tmplitem",u=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,p={},e={},z,y={key:0,data:{}},w=0,q=0,g=[];function k(C,B,E,F){var D={data:F||(B?B.data:{}),_wrap:B?B._wrap:null,tmpl:null,parent:B||null,nodes:[],calls:c,nest:b,wrap:n,html:r,update:A};if(C){i.extend(D,C,{nodes:[],parent:B})}if(E){D.tmpl=E;D._ctnt=D._ctnt||D.tmpl(i,D);D.key=++w;(g.length?e:p)[w]=D}return D}i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(B,C){i.fn[B]=function(D){var G=[],J=i(D),F,H,E,K,I=this.length===1&&this[0].parentNode;z=p||{};if(I&&I.nodeType===11&&I.childNodes.length===1&&J.length===1){J[C](this[0]);G=this}else{for(H=0,E=J.length;H<E;H++){q=H;F=(H>0?this.clone(true):this).get();i(J[H])[C](F);G=G.concat(F)}q=0;G=this.pushStack(G,B,J.selector)}K=z;z=null;i.tmpl.complete(K);return G}});i.fn.extend({tmpl:function(D,C,B){return i.tmpl(this[0],D,C,B)},tmplItem:function(){return i.tmplItem(this[0])},template:function(B){return i.template(B,this[0])},domManip:function(F,I,H,J){if(F[0]&&i.isArray(F[0])){var C=i.makeArray(arguments),B=F[0],G=B.length,D=0,E;while(D<G&&!(E=i.data(B[D++],"tmplItem"))){}if(E&&q){C[2]=function(K){i.tmpl.afterManip(this,K,H)}}t.apply(this,C)}else{t.apply(this,arguments)}q=0;if(!z){i.tmpl.complete(p)}return this}});i.extend({tmpl:function(D,G,F,C){var E,B=!C;if(B){C=y;D=i.template[D]||i.template(null,D);e={}}else{if(!D){D=C.tmpl;p[C.key]=C;C.nodes=[];if(C.wrapped){s(C,C.wrapped)}return i(m(C,null,C.tmpl(i,C)))}}if(!D){return[]}if(typeof G==="function"){G=G.call(C||{})}if(F&&F.wrapped){s(F,F.wrapped)}E=i.isArray(G)?i.map(G,function(H){return H?k(F,C,D,H):null}):[k(F,C,D,G)];return B?i(m(C,null,E)):E},tmplItem:function(C){var B;if(C instanceof i){C=C[0]}while(C&&C.nodeType===1&&!(B=i.data(C,"tmplItem"))&&(C=C.parentNode)){}return B||y},template:function(C,B){if(B){if(typeof B==="string"){B=l(B)}else{if(B instanceof i){B=B[0]||{}}}if(B.nodeType){B=i.data(B,"tmpl")||i.data(B,"tmpl",l(B.innerHTML))}return typeof C==="string"?(i.template[C]=B):B}return C?(typeof C!=="string"?i.template(null,C):(i.template[C]||i.template(null,u.test(C)?C:i(C)))):null},encode:function(B){return(""+B).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});i.extend(i.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(B){p={}},afterManip:function v(D,B,E){var C=B.nodeType===11?i.makeArray(B.childNodes):B.nodeType===1?[B]:[];E.call(D,B);o(C);q++}});function m(B,F,D){var E,C=D?i.map(D,function(G){return(typeof G==="string")?(B.key?G.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+h+'="'+B.key+'" $2'):G):m(G,B,G._ctnt)}):B;if(F){return C}C=C.join("");C.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(H,I,G,J){E=i(G).get();o(E);if(I){E=a(I).concat(E)}if(J){E=E.concat(a(J))}});return E?E:a(C)}function a(C){var B=document.createElement("div");B.innerHTML=C;return i.makeArray(B.childNodes)}function l(B){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+i.trim(B).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(J,D,H,E,F,K,G){var M=i.tmpl.tag[H],C,I,L;if(!M){throw"Template command not found: "+H}C=M._default||[];if(K&&!/\w$/.test(F)){F+=K;K=""}if(F){F=j(F);G=G?(","+j(G)+")"):(K?")":"");I=K?(F.indexOf(".")>-1?F+j(K):("("+F+").call($item"+G)):F;L=K?I:"(typeof("+F+")==='function'?("+F+").call($item):("+F+"))"}else{L=I=C.$1||"null"}E=j(E);return"');"+M[D?"close":"open"].split("$notnull_1").join(F?"typeof("+F+")!=='undefined' && ("+F+")!=null":"true").split("$1a").join(L).split("$1").join(I).split("$2").join(E||C.$2||"")+"_.push('"})+"');}return _;")}function s(C,B){C._wrap=m(C,true,i.isArray(B)?B:[u.test(B)?B:i(B).html()]).join("")}function j(B){return B?B.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function d(B){var C=document.createElement("div");C.appendChild(B.cloneNode(true));return C.innerHTML}function o(H){var J="_"+q,C,B,F={},G,E,D;for(G=0,E=H.length;G<E;G++){if((C=H[G]).nodeType!==1){continue}B=C.getElementsByTagName("*");for(D=B.length-1;D>=0;D--){I(B[D])}I(C)}function I(P){var M,O=P,N,K,L;if((L=P.getAttribute(h))){while(O.parentNode&&(O=O.parentNode).nodeType===1&&!(M=O.getAttribute(h))){}if(M!==L){O=O.parentNode?(O.nodeType===11?0:(O.getAttribute(h)||0)):0;if(!(K=p[L])){K=e[L];K=k(K,p[O]||e[O]);K.key=++w;p[w]=K}if(q){Q(L)}}P.removeAttribute(h)}else{if(q&&(K=i.data(P,"tmplItem"))){Q(K.key);p[K.key]=K;O=i.data(P.parentNode,"tmplItem");O=O?O.key:0}}if(K){N=K;while(N&&N.key!=O){N.nodes.push(P);N=N.parent}delete K._ctnt;delete K._wrap;i.data(P,"tmplItem",K)}function Q(R){R=R+J;K=F[R]=(F[R]||k(K,p[K.parent.key+J]||K.parent))}}}function c(D,B,E,C){if(!D){return g.pop()}g.push({_:D,tmpl:B,item:this,data:E,options:C})}function b(B,D,C){return i.tmpl(i.template(B),D,C,this)}function n(D,B){var C=D.options||{};C.wrapped=B;return i.tmpl(i.template(D.tmpl),D.data,C,D.item)}function r(C,D){var B=this._wrap;return i.map(i(i.isArray(B)?B.join(""):B).filter(C||"*"),function(E){return D?E.innerText||E.textContent:E.outerHTML||d(E)})}function A(){var B=this.nodes;i.tmpl(null,null,null,this).insertBefore(B[0]);i(B).remove()}})(jQuery);(function(b){jQuery.browser.mobile=/android|avantgo|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(b.substr(0,4))})(navigator.userAgent||navigator.vendor||window.opera);function hoozit(a){if(a.constructor===String){return"string"}else{if(a.constructor===Boolean){return"boolean"}else{if(a.constructor===Number){if(isNaN(a)){return"nan"}else{return"number"}}else{if(typeof a==="undefined"){return"undefined"}else{if(a===null){return"null"}else{if(a instanceof Array){return"array"}else{if(a instanceof Date){return"date"}else{if(a instanceof RegExp){return"regexp"}else{if(typeof a==="object"){return"object"}else{if(a instanceof Function){return"function"}else{return undefined}}}}}}}}}}}function bindCallbacks(c,b,a){var d=hoozit(c);if(d){if(hoozit(b[d])==="function"){return b[d].apply(b,a)}else{return b[d]}}}var equiv=function(){var b;var c=[];var a=function(){function d(e,f){if(e instanceof f.constructor||f instanceof e.constructor){return f==e}else{return f===e}}return{string:d,"boolean":d,number:d,"null":d,"undefined":d,nan:function(e){return isNaN(e)},date:function(e,f){return hoozit(e)==="date"&&f.valueOf()===e.valueOf()},regexp:function(e,f){return hoozit(e)==="regexp"&&f.source===e.source&&f.global===e.global&&f.ignoreCase===e.ignoreCase&&f.multiline===e.multiline},"function":function(){var e=c[c.length-1];return e!==Object&&typeof e!=="undefined"},array:function(f,g){var h;var e;if(!(hoozit(f)==="array")){return false}e=g.length;if(e!==f.length){return false}for(h=0;h<e;h++){if(!b(g[h],f[h])){return false}}return true},object:function(f,g){var j;var e=true;var h=[],k=[];if(g.constructor!==f.constructor){return false}c.push(g.constructor);for(j in g){h.push(j);if(!b(g[j],f[j])){e=false}}c.pop();for(j in f){k.push(j)}return e&&b(h.sort(),k.sort())}}}();b=function(){var d=Array.prototype.slice.apply(arguments);if(d.length<2){return true}return(function(f,e){if(f===e){return true}else{if(f===null||e===null||typeof f==="undefined"||typeof e==="undefined"||hoozit(f)!==hoozit(e)){return false}else{return bindCallbacks(f,a,[e,f])}}})(d[0],d[1])&&arguments.callee.apply(this,d.splice(1,d.length-1))};return b}();(function(e){var a=0;var b={iframe:"iframe",popup:"popup"};var d={mode:b.iframe,popHt:500,popWd:400,popX:200,popY:200,popTitle:"",popClose:false};var c={};e.fn.printArea=function(n){e.extend(c,d,n);a++;var o="printArea_";e("[id^="+o+"]").remove();var q=i(e(this));c.id=o+a;var l;var m;switch(c.mode){case b.iframe:var p=new g();l=p.doc;m=p.contentWindow||p;break;case b.popup:m=new k();l=m.doc}l.open();l.write(h()+"<html>"+j()+f(q)+"</html>");l.close();m.focus();m.print();if(c.mode==b.popup&&c.popClose){m.close()}};function h(){if(c.mode==b.iframe||!c.strict){return""}var l=c.strict==false?" Trasitional":"";var m=c.strict==false?"loose":"strict";return'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01'+l+'//EN" "http://www.w3.org/TR/html4/'+m+'.dtd">'}function j(){var l="<head><title>"+c.popTitle+"</title>";e(document).find("link").filter(function(){return e(this).attr("rel").toLowerCase()=="stylesheet"}).filter(function(){var m=e(this).attr("media");return(m.toLowerCase()==""||m.toLowerCase()=="print")}).each(function(){l+='<link type="text/css" rel="stylesheet" href="'+e(this).attr("href")+'" >'});l+="</head>";return l}function f(l){return'<body><div class="'+e(l).attr("class")+'">'+e(l).html()+"</div></body>"}function i(l){e("input,select,textarea",l).each(function(){var n=e(this).attr("type");if(n=="radio"||n=="checkbox"){if(e(this).is(":not(:checked)")){this.removeAttribute("checked")}else{this.setAttribute("checked",true)}}else{if(n=="text"){this.setAttribute("value",e(this).val())}else{if(n=="select-multiple"||n=="select-one"){e(this).find("option").each(function(){if(e(this).is(":not(:selected)")){this.removeAttribute("selected")}else{this.setAttribute("selected",true)}})}else{if(n=="textarea"){var m=e(this).attr("value");if(e.browser.mozilla){if(this.firstChild){this.firstChild.textContent=m}else{this.textContent=m}}else{this.innerHTML=m}}}}}});return l}function g(){var n=c.id;var l="border:0;position:absolute;width:0px;height:0px;left:0px;top:0px;";var m;try{m=document.createElement("iframe");document.body.appendChild(m);e(m).attr({style:l,id:n,src:""});m.doc=null;m.doc=m.contentDocument?m.contentDocument:(m.contentWindow?m.contentWindow.document:m.document)}catch(o){throw o+". iframes may not be supported in this browser."}if(m.doc==null){throw"Cannot find document."}return m}function k(){var m="location=yes,statusbar=no,directories=no,menubar=no,titlebar=no,toolbar=no,dependent=no";m+=",width="+c.popWd+",height="+c.popHt;m+=",resizable=yes,screenX="+c.popX+",screenY="+c.popY+",personalbar=no,scrollbars=no";var l=window.open("","_blank",m);l.doc=l.document;return l}})(jQuery);(function(e){var f=(e.browser.msie?"paste":"input")+".mask";var d=(window.orientation!=undefined);e.mask={definitions:{"9":"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"}};e.fn.extend({caret:function(b,a){if(this.length==0){return}if(typeof b=="number"){a=(typeof a=="number")?a:b;return this.each(function(){if(this.setSelectionRange){this.focus();this.setSelectionRange(b,a)}else{if(this.createTextRange){var h=this.createTextRange();h.collapse(true);h.moveEnd("character",a);h.moveStart("character",b);h.select()}}})}else{if(this[0].setSelectionRange){b=this[0].selectionStart;a=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var c=document.selection.createRange();b=0-c.duplicate().moveStart("character",-100000);a=b+c.text.length}}return{begin:b,end:a}}},unmask:function(){return this.trigger("unmask")},mask:function(b,p){if(!b&&this.length>0){var n=e(this[0]);var m=n.data("tests");return e.map(n.data("buffer"),function(h,g){return m[g]?h:null}).join("")}p=e.extend({placeholder:"_",completed:null},p);var a=e.mask.definitions;var m=[];var o=b.length;var c=null;var l=b.length;e.each(b.split(""),function(g,h){if(h=="?"){l--;o=g}else{if(a[h]){m.push(new RegExp(a[h]));if(c==null){c=m.length-1}}else{m.push(null)}}});return this.each(function(){var g=e(this);var y=e.map(b.split(""),function(q,r){if(q!="?"){return a[q]?p.placeholder:q}});var k=false;var h=g.val();g.data("buffer",y).data("tests",m);function B(q){while(++q<=l&&!m[q]){}return q}function D(q){while(!m[q]&&--q>=0){}for(var s=q;s<l;s++){if(m[s]){y[s]=p.placeholder;var r=B(s);if(r<l&&m[s].test(y[r])){y[s]=y[r]}else{break}}}E();g.caret(Math.max(c,q))}function C(u){for(var r=u,s=p.placeholder;r<l;r++){if(m[r]){var t=B(r);var q=y[r];y[r]=s;if(t<l&&m[t].test(q)){s=q}else{break}}}}function z(s){var q=e(this).caret();var r=s.keyCode;k=(r<16||(r>16&&r<32)||(r>32&&r<41));if((q.begin-q.end)!=0&&(!k||r==8||r==46)){A(q.begin,q.end)}if(r==8||r==46||(d&&r==127)){D(q.begin+(r==46?0:-1));return false}else{if(r==27){g.val(h);g.caret(0,i());return false}}}function j(v){if(k){k=false;return(v.keyCode==8)?false:null}v=v||window.event;var t=v.charCode||v.keyCode||v.which;var s=e(this).caret();if(v.ctrlKey||v.altKey||v.metaKey){return true}else{if((t>=32&&t<=125)||t>186){var r=B(s.begin-1);if(r<l){var q=String.fromCharCode(t);if(m[r].test(q)){C(r);y[r]=q;E();var u=B(r);e(this).caret(u);if(p.completed&&u==l){p.completed.call(g)}}}}}return false}function A(q,s){for(var r=q;r<s&&r<l;r++){if(m[r]){y[r]=p.placeholder}}}function E(){return g.val(y.join("")).val()}function i(v){var t=g.val();var s=-1;for(var u=0,r=0;u<l;u++){if(m[u]){y[u]=p.placeholder;while(r++<t.length){var q=t.charAt(r-1);if(m[u].test(q)){y[u]=q;s=u;break}}if(r>t.length){break}}else{if(y[u]==t[r]&&u!=o){r++;s=u}}}if(!v&&s+1<o){g.val("");A(0,l)}else{if(v||s+1>=o){E();if(!v){g.val(g.val().substring(0,s+1))}}}return(o?u:c)}if(!g.attr("readonly")){g.one("unmask",function(){g.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){h=g.val();var q=i();E();setTimeout(function(){if(q==b.length){g.caret(0,q)}else{g.caret(q)}},0)}).bind("blur.mask",function(){i();if(g.val()!=h){g.change()}}).bind("keydown.mask",z).bind("keypress.mask",j).bind(f,function(){setTimeout(function(){g.caret(i(true))},0)})}i()})}})})(jQuery);(function(c){var a=window.console?window.console:{log:c.noop,error:function(e){c.error(e)}};var b=(("prop" in c.fn)&&("removeProp" in c.fn));function d(){this.controls={bold:{groupIndex:0,visible:true,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:false,tooltip:"Copy"},createLink:{groupIndex:6,visible:true,exec:function(){var e=this;if(c.wysiwyg.controls&&c.wysiwyg.controls.link){c.wysiwyg.controls.link.init(this)}else{if(c.wysiwyg.autoload){c.wysiwyg.autoload.control("wysiwyg.link.js",function(){e.controls.createLink.exec.apply(e)})}else{a.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")}}},tags:["a"],tooltip:"Create link"},unLink:{groupIndex:6,visible:true,exec:function(){this.editorDoc.execCommand("unlink",false,null)},tooltip:"Remove link"},cut:{groupIndex:8,visible:false,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:false,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:true,className:"h1",command:(c.browser.msie||c.browser.safari)?"FormatBlock":"heading","arguments":(c.browser.msie||c.browser.safari)?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:true,className:"h2",command:(c.browser.msie||c.browser.safari)?"FormatBlock":"heading","arguments":(c.browser.msie||c.browser.safari)?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:true,className:"h3",command:(c.browser.msie||c.browser.safari)?"FormatBlock":"heading","arguments":(c.browser.msie||c.browser.safari)?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:false,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var h,g,f,e;if(c.browser.msie||c.browser.safari){h="backcolor"}else{h="hilitecolor"}if(c.browser.msie){g=this.getInternalRange().parentElement()}else{f=this.getInternalSelection();g=f.extentNode||f.focusNode;while(g.style===undefined){g=g.parentNode;if(g.tagName&&g.tagName.toLowerCase()==="body"){return}}}if(g.style.backgroundColor==="rgb(255, 255, 102)"||g.style.backgroundColor==="#ffff66"){e="#ffffff"}else{e="#ffff66"}this.editorDoc.execCommand(h,false,e)}},html:{groupIndex:10,visible:false,exec:function(){var e;if(this.options.resizeOptions&&c.fn.resizable){e=this.element.height()}if(this.viewHTML){this.setContent(this.original.value);c(this.original).hide();this.editor.show();if(this.options.resizeOptions&&c.fn.resizable){if(e===this.element.height()){this.element.height(e+this.editor.height())}this.element.resizable(c.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}this.ui.toolbar.find("li").each(function(){var f=c(this);if(f.hasClass("html")){f.removeClass("active")}else{f.removeClass("disabled")}})}else{this.saveContent();c(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show();this.editor.hide();if(this.options.resizeOptions&&c.fn.resizable){if(e===this.element.height()){this.element.height(this.ui.toolbar.height())}this.element.resizable("destroy")}this.ui.toolbar.find("li").each(function(){var f=c(this);if(f.hasClass("html")){f.addClass("active")}else{if(false===f.hasClass("fullscreen")){f.removeClass("active").addClass("disabled")}}})}this.viewHTML=!(this.viewHTML)},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:false,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:true,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:true,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:true,exec:function(){var e=this;if(c.wysiwyg.controls&&c.wysiwyg.controls.image){c.wysiwyg.controls.image.init(this)}else{if(c.wysiwyg.autoload){c.wysiwyg.autoload.control("wysiwyg.image.js",function(){e.controls.insertImage.exec.apply(e)})}else{a.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")}}},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:true,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:true,exec:function(){var e=this;if(c.wysiwyg.controls&&c.wysiwyg.controls.table){c.wysiwyg.controls.table(this)}else{if(c.wysiwyg.autoload){c.wysiwyg.autoload.control("wysiwyg.table.js",function(){e.controls.insertTable.exec.apply(e)})}else{a.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")}}},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:true,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:true,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:true,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:true,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:true,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:true,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:false,exec:function(){var e=this.dom.getElement("p");if(!e){return false}c(e).attr("dir","ltr");return true},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:true,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:false,className:"paragraph",command:"FormatBlock","arguments":(c.browser.msie||c.browser.safari)?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:false,tooltip:"Paste"},redo:{groupIndex:4,visible:true,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:true,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:false,exec:function(){var e=this.dom.getElement("p");if(!e){return false}c(e).attr("dir","rtl");return true},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:true,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:true,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:true,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:true,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:true,tooltip:"Undo"},code:{visible:true,groupIndex:6,tooltip:"Code snippet",exec:function(){var e=this.getInternalRange(),f=c(e.commonAncestorContainer),g=e.commonAncestorContainer.nodeName.toLowerCase();if(f.parent("code").length){f.unwrap()}else{if(g!=="body"){f.wrap("<code/>")}}}},cssWrap:{visible:false,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){c.wysiwyg.controls.cssWrap.init(this)}}};this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;">INITIAL_CONTENT</body></html>',debug:false,controls:{},css:{},events:{},autoGrow:false,autoSave:true,brIE:true,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"",maxHeight:10000,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:false,replaceDivWithP:false,resizeOptions:false,rmUnusedControls:false,rmUnwantedBr:true,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:false},controlLink:{forceRelativeUrls:false},plugins:{autoload:false,i18n:false,rmFormat:{rmMsWordMarkup:false}},dialog:"default"};this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"];this.editor=null;this.editorDoc=null;this.element=null;this.options={};this.original=null;this.savedRange=null;this.timers=[];this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46];this.isDestroyed=false;this.dom={ie:{parent:null},w3c:{parent:null}};this.dom.parent=this;this.dom.ie.parent=this.dom;this.dom.w3c.parent=this.dom;this.ui={};this.ui.self=this;this.ui.toolbar=null;this.ui.initialHeight=null;this.dom.getAncestor=function(e,f){f=f.toLowerCase();while(e&&typeof e.tagName!="undefined"&&"body"!==e.tagName.toLowerCase()){if(f===e.tagName.toLowerCase()){return e}e=e.parentNode}if(!e.tagName&&(e.previousSibling||e.nextSibling)){if(e.previousSibling){if(e.previousSibling.tagName.toLowerCase()==f){return e.previousSibling}}if(e.nextSibling){if(e.nextSibling.tagName.toLowerCase()==f){return e.nextSibling}}}return null};this.dom.getElement=function(f){var e=this;f=f.toLowerCase();if(window.getSelection){return e.w3c.getElement(f)}else{return e.ie.getElement(f)}};this.dom.ie.getElement=function(i){var h=this.parent,g=h.parent.getInternalSelection(),e=g.createRange(),f;if("Control"===g.type){if(1===e.length){f=e.item(0)}else{return null}}else{f=e.parentElement()}return h.getAncestor(f,i)};this.dom.w3c.getElement=function(h){var g=this.parent,e=g.parent.getInternalRange(),f;if(!e){return null}f=e.commonAncestorContainer;if(3===f.nodeType){f=f.parentNode}if(f===e.startContainer){f=f.childNodes[e.startOffset]}if(!f.tagName&&(f.previousSibiling||f.nextSibling)){if(f.previousSibiling){if(f.previousSibiling.tagName.toLowerCase()==h){return f.previousSibiling}}if(f.nextSibling){if(f.nextSibling.tagName.toLowerCase()==h){return f.nextSibling}}}return g.getAncestor(f,h)};this.ui.addHoverClass=function(){c(this).addClass("wysiwyg-button-hover")};this.ui.appendControls=function(){var k=this,n=this.self,m=n.parseControls(),l=true,e=[],f={},g,h,j=function(o,i){if(i.groupIndex&&h!==i.groupIndex){h=i.groupIndex;l=false}if(!i.visible){return}if(!l){k.appendItemSeparator();l=true}if(i.custom){k.appendItemCustom(o,i)}else{k.appendItem(o,i)}};c.each(m,function(o,p){var i="empty";if(undefined!==p.groupIndex){if(""===p.groupIndex){i="empty"}else{i=p.groupIndex}}if(undefined===f[i]){e.push(i);f[i]={}}f[i][o]=p});e.sort(function(o,i){if("number"===typeof(o)&&typeof(o)===typeof(i)){return(o-i)}else{o=o.toString();i=i.toString();if(o>i){return 1}if(o===i){return 0}return -1}});if(0<e.length){h=e[0]}for(g=0;g<e.length;g+=1){c.each(f[e[g]],j)}};this.ui.appendItem=function(f,i){var e=this.self,g=i.className||i.command||f||"empty",h=i.tooltip||i.command||f||"";return c('<li role="menuitem" unselectable="on">'+(g)+"</li>").addClass(g).attr("title",h).hover(this.addHoverClass,this.removeHoverClass).click(function(k){if(c(this).hasClass("disabled")){return false}e.triggerControl.apply(e,[f,i]);var j=c(k.target);for(var l in e.controls){if(j.hasClass(l)){e.ui.toolbar.find("."+l).toggleClass("active");e.editorDoc.rememberCommand=true;break}}this.blur();e.ui.returnRange();e.ui.focus();return true}).appendTo(e.ui.toolbar)};this.ui.appendItemCustom=function(f,h){var e=this.self,g=h.tooltip||h.command||f||"";if(h.callback){c(window).bind("trigger-"+f+".wysiwyg",h.callback)}return c('<li role="menuitem" unselectable="on" style="background: url(\''+h.icon+"') no-repeat;\"></li>").addClass("custom-command-"+f).addClass("wysiwyg-custom-command").addClass(f).attr("title",g).hover(this.addHoverClass,this.removeHoverClass).click(function(){if(c(this).hasClass("disabled")){return false}e.triggerControl.apply(e,[f,h]);this.blur();e.ui.returnRange();e.ui.focus();e.triggerControlCallback(f);return true}).appendTo(e.ui.toolbar)};this.ui.appendItemSeparator=function(){var e=this.self;return c('<li role="separator" class="separator"></li>').appendTo(e.ui.toolbar)};this.autoSaveFunction=function(){this.saveContent()};this.ui.checkTargets=function(f){var e=this.self;c.each(e.options.controls,function(h,l){var k=l.className||l.command||h||"empty",g,n,i,j,m=function(p,o){var q;if("function"===typeof(o)){q=o;if(q(j.css(p).toString().toLowerCase(),e)){e.ui.toolbar.find("."+k).addClass("active")}}else{if(j.css(p).toString().toLowerCase()===o){e.ui.toolbar.find("."+k).addClass("active")}}};if("fullscreen"!==k){e.ui.toolbar.find("."+k).removeClass("active")}if(l.tags||(l.options&&l.options.tags)){g=l.tags||(l.options&&l.options.tags);n=f;while(n){if(n.nodeType!==1){break}if(c.inArray(n.tagName.toLowerCase(),g)!==-1){e.ui.toolbar.find("."+k).addClass("active")}n=n.parentNode}}if(l.css||(l.options&&l.options.css)){i=l.css||(l.options&&l.options.css);j=c(f);while(j){if(j[0].nodeType!==1){break}c.each(i,m);j=j.parent()}}})};this.ui.designMode=function(){var f=3,e=this.self,g;g=function(h){if("on"===e.editorDoc.designMode){if(e.timers.designMode){window.clearTimeout(e.timers.designMode)}if(e.innerDocument()!==e.editorDoc){e.ui.initFrame()}return}try{e.editorDoc.designMode="on"}catch(i){}h-=1;if(h>0){e.timers.designMode=window.setTimeout(function(){g(h)},100)}};g(f)};this.destroy=function(){this.isDestroyed=true;var f,e=this.element.closest("form");for(f=0;f<this.timers.length;f+=1){window.clearTimeout(this.timers[f])}e.unbind(".wysiwyg");this.element.remove();c.removeData(this.original,"wysiwyg");c(this.original).show();return this};this.getRangeText=function(){var e=this.getInternalRange();if(e.toString){e=e.toString()}else{if(e.text){e=e.text}}return e};this.execute=function(f,e){if(typeof(e)==="undefined"){e=null}this.editorDoc.execCommand(f,false,e)};this.extendOptions=function(f){var e={};if("object"===typeof f.controls){e=f.controls;delete f.controls}f=c.extend(true,{},this.defaults,f);f.controls=c.extend(true,{},e,this.controls,e);if(f.rmUnusedControls){c.each(f.controls,function(g){if(!e[g]){delete f.controls[g]}})}return f};this.ui.focus=function(){var e=this.self;e.editor.get(0).contentWindow.focus();return e};this.ui.returnRange=function(){var f=this.self,g;if(f.savedRange!==null){if(window.getSelection){g=window.getSelection();if(g.rangeCount>0){g.removeAllRanges()}try{g.addRange(f.savedRange)}catch(h){a.error(h)}}else{if(window.document.createRange){window.getSelection().addRange(f.savedRange)}else{if(window.document.selection){f.savedRange.select()}}}f.savedRange=null}};this.increaseFontSize=function(){if(c.browser.mozilla||c.browser.opera){this.editorDoc.execCommand("increaseFontSize",false,null)}else{if(c.browser.safari){var h=this.getInternalRange(),g=this.getInternalSelection(),f=this.editorDoc.createElement("big");if(true===h.collapsed&&3===h.commonAncestorContainer.nodeType){var i=h.commonAncestorContainer.nodeValue.toString(),j=i.lastIndexOf(" ",h.startOffset)+1,e=(-1===i.indexOf(" ",h.startOffset))?i:i.indexOf(" ",h.startOffset);h.setStart(h.commonAncestorContainer,j);h.setEnd(h.commonAncestorContainer,e);h.surroundContents(f);g.addRange(h)}else{h.surroundContents(f);g.removeAllRanges();g.addRange(h)}}else{a.error("Internet Explorer?")}}};this.decreaseFontSize=function(){if(c.browser.mozilla||c.browser.opera){this.editorDoc.execCommand("decreaseFontSize",false,null)}else{if(c.browser.safari){var h=this.getInternalRange(),g=this.getInternalSelection(),f=this.editorDoc.createElement("small");if(true===h.collapsed&&3===h.commonAncestorContainer.nodeType){var i=h.commonAncestorContainer.nodeValue.toString(),j=i.lastIndexOf(" ",h.startOffset)+1,e=(-1===i.indexOf(" ",h.startOffset))?i:i.indexOf(" ",h.startOffset);h.setStart(h.commonAncestorContainer,j);h.setEnd(h.commonAncestorContainer,e);h.surroundContents(f);g.addRange(h)}else{h.surroundContents(f);g.removeAllRanges();g.addRange(h)}}else{a.error("Internet Explorer?")}}};this.getContent=function(){if(this.viewHTML){this.setContent(this.original.value)}return this.events.filter("getContent",this.editorDoc.body.innerHTML)};this.events={_events:{},bind:function(e,f){if(typeof(this._events.eventName)!=="object"){this._events[e]=[]}this._events[e].push(f)},trigger:function(e,f){if(typeof(this._events.eventName)==="object"){var g=this.editor;c.each(this._events[e],function(i,h){if(typeof(h)==="function"){h.apply(g,f)}})}},filter:function(e,h){if(typeof(this._events[e])==="object"){var g=this.editor,f=Array.prototype.slice.call(arguments,1);c.each(this._events[e],function(j,i){if(typeof(i)==="function"){h=i.apply(g,f)}})}return h}};this.getElementByAttributeValue=function(g,e,h){var f,k,j=this.editorDoc.getElementsByTagName(g);for(f=0;f<j.length;f+=1){k=j[f].getAttribute(e);if(c.browser.msie){k=k.substr(k.length-h.length)}if(k===h){return j[f]}}return false};this.getInternalRange=function(){var e=this.getInternalSelection();if(!e){return null}if(e.rangeCount&&e.rangeCount>0){return e.getRangeAt(0)}else{if(e.createRange){return e.createRange()}}return null};this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection){return this.editor.get(0).contentWindow.getSelection()}if(this.editor.get(0).contentWindow.selection){return this.editor.get(0).contentWindow.selection}}if(this.editorDoc.getSelection){return this.editorDoc.getSelection()}if(this.editorDoc.selection){return this.editorDoc.selection}return null};this.getRange=function(){var e=this.getSelection();if(!e){return null}if(e.rangeCount&&e.rangeCount>0){e.getRangeAt(0)}else{if(e.createRange){return e.createRange()}}return null};this.getSelection=function(){return(window.getSelection)?window.getSelection():window.document.selection};this.ui.grow=function(){var f=this.self,i=c(f.editorDoc.body),h=c.browser.msie?i[0].scrollHeight:i.height()+2+20,g=f.ui.initialHeight,e=Math.max(h,g);e=Math.min(e,f.options.maxHeight);f.editor.attr("scrolling",e<f.options.maxHeight?"no":"auto");i.css("overflow",e<f.options.maxHeight?"hidden":"");f.editor.get(0).height=e;return f};this.init=function(i,h){var g=this,f=c(i).closest("form"),k=(i.width||i.clientWidth||0),j=(i.height||i.clientHeight||0);this.options=this.extendOptions(h);this.original=i;this.ui.toolbar=c(this.options.toolbarHtml);if(c.browser.msie&&parseInt(c.browser.version,10)<8){this.options.autoGrow=false}if(k===0&&i.cols){k=(i.cols*8)+21}if(j===0&&i.rows){j=(i.rows*16)+16}this.editor=c(window.location.protocol==="https:"?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0");if(this.options.iFrameClass){this.editor.addClass(this.options.iFrameClass)}else{this.editor.css({minHeight:(j-6).toString()+"px",width:(k>50)?(k-8).toString()+"px":""});if(c.browser.msie&&parseInt(c.browser.version,10)<7){this.editor.css("height",j.toString()+"px")}}if(i.id){var e=i.id+"-wysiwyg-iframe";if(!document.getElementById(e)){this.editor.attr("id",e)}}this.editor.attr("tabindex",c(i).attr("tabindex"));this.element=c("<div/>").addClass("wysiwyg");if(!this.options.iFrameClass){this.element.css({width:(k>0)?k.toString()+"px":"100%"})}c(i).hide().before(this.element);this.viewHTML=false;this.initialContent=c(i).val();this.ui.initFrame();if(this.options.resizeOptions&&c.fn.resizable){this.element.resizable(c.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}if(this.options.autoSave){f.bind("submit.wysiwyg",function(){g.autoSaveFunction()})}f.bind("reset.wysiwyg",function(){g.resetFunction()})};this.ui.initFrame=function(){var e=this.self,g,i,f;e.ui.appendControls();e.element.append(e.ui.toolbar).append(c("<div><!-- --></div>").css({clear:"both"})).append(e.editor);e.editorDoc=e.innerDocument();if(e.isDestroyed){return null}e.ui.designMode();e.editorDoc.open();e.editorDoc.write(e.options.html.replace(/INITIAL_CONTENT/,function(){return e.wrapInitialContent()}));e.editorDoc.close();c.wysiwyg.plugin.bind(e);c(e.editorDoc).trigger("initFrame.wysiwyg");c(e.editorDoc).bind("click.wysiwyg",function(j){e.ui.checkTargets(j.target?j.target:j.srcElement)});setInterval(function(){var l=null;try{var j=e.getInternalRange();if(j){l={range:j,parent:c.browser.msie?j.parentElement():j.endContainer.parentNode,width:(c.browser.msie?j.boundingWidth:j.startOffset-j.endOffset)||0}}}catch(k){a.error(k)}if(l&&l.width==0&&!e.editorDoc.rememberCommand){e.ui.checkTargets(l.parent)}},400);c(e.original).focus(function(){if(c(this).filter(":visible").length===0){return}e.ui.focus()});c(e.editorDoc).keydown(function(j){var k;if(j.keyCode===8){k=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/;if(k.test(e.getContent())){j.stopPropagation();return false}}e.editorDoc.rememberCommand=false;return true});if(!c.browser.msie){c(e.editorDoc).keydown(function(j){var k;if(j.ctrlKey||j.metaKey){for(k in e.controls){if(e.controls[k].hotkey&&e.controls[k].hotkey.ctrl){if(j.keyCode===e.controls[k].hotkey.key){e.triggerControl.apply(e,[k,e.controls[k]]);return false}}}}return true})}else{if(e.options.brIE){c(e.editorDoc).keydown(function(k){if(k.keyCode===13){var j=e.getRange();j.pasteHTML("<br/>");j.collapse(false);j.select();return false}return true})}}if(e.options.plugins.rmFormat.rmMsWordMarkup){c(e.editorDoc).bind("keyup.wysiwyg",function(j){if(j.ctrlKey||j.metaKey){if(86===j.keyCode){if(c.wysiwyg.rmFormat){if("object"===typeof(e.options.plugins.rmFormat.rmMsWordMarkup)){c.wysiwyg.rmFormat.run(e,{rules:{msWordMarkup:e.options.plugins.rmFormat.rmMsWordMarkup}})}else{c.wysiwyg.rmFormat.run(e,{rules:{msWordMarkup:{enabled:true}}})}}}}})}if(e.options.autoSave){c(e.editorDoc).keydown(function(){e.autoSaveFunction()}).keyup(function(){e.autoSaveFunction()}).mousedown(function(){e.autoSaveFunction()}).bind(c.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){e.autoSaveFunction()})}if(e.options.autoGrow){if(e.options.initialMinHeight!==null){e.ui.initialHeight=e.options.initialMinHeight}else{e.ui.initialHeight=c(e.editorDoc).height()}c(e.editorDoc.body).css("border","1px solid white");i=function(){e.ui.grow()};c(e.editorDoc).keyup(i);c(e.editorDoc).bind("editorRefresh.wysiwyg",i);e.ui.grow()}if(e.options.css){if(String===e.options.css.constructor){if(c.browser.msie){g=e.editorDoc.createStyleSheet(e.options.css);c(g).attr({media:"all"})}else{g=c("<link/>").attr({href:e.options.css,media:"all",rel:"stylesheet",type:"text/css"});c(e.editorDoc).find("head").append(g)}}else{e.timers.initFrame_Css=window.setTimeout(function(){c(e.editorDoc.body).css(e.options.css)},0)}}if(e.initialContent.length===0){if("function"===typeof(e.options.initialContent)){e.setContent(e.options.initialContent())}else{e.setContent(e.options.initialContent)}}if(e.options.maxLength>0){c(e.editorDoc).keydown(function(j){if(c(e.editorDoc).text().length>=e.options.maxLength&&c.inArray(j.which,e.validKeyCodes)===-1){j.preventDefault()}})}c.each(e.options.events,function(j,k){c(e.editorDoc).bind(j+".wysiwyg",function(l){k.apply(e.editorDoc,[l,e])})});if(c.browser.msie){c(e.editorDoc).bind("beforedeactivate.wysiwyg",function(){e.savedRange=e.getInternalRange()})}else{c(e.editorDoc).bind("blur.wysiwyg",function(){e.savedRange=e.getInternalRange()})}c(e.editorDoc.body).addClass("wysiwyg");if(e.options.events&&e.options.events.save){f=e.options.events.save;c(e.editorDoc).bind("keyup.wysiwyg",f);c(e.editorDoc).bind("change.wysiwyg",f);if(c.support.noCloneEvent){c(e.editorDoc).bind("input.wysiwyg",f)}else{c(e.editorDoc).bind("paste.wysiwyg",f);c(e.editorDoc).bind("cut.wysiwyg",f)}}if(e.options.xhtml5&&e.options.unicode){var h={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};e.events.bind("getContent",function(j){return j.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(m,l){if(!h[l]){l=l.toLowerCase();if(!h[l]){l="__replacement"}}var k=h[l];return String.fromCharCode(k)})})}c(e.original).trigger("ready.jwysiwyg",[e.editorDoc,e])};this.innerDocument=function(){var e=this.editor.get(0);if(e.nodeName.toLowerCase()==="iframe"){if(e.contentDocument){return e.contentDocument}else{if(e.contentWindow){return e.contentWindow.document}}if(this.isDestroyed){return null}a.error("Unexpected error in innerDocument")}return e};this.insertHtml=function(e){var g,f;if(!e||e.length===0){return this}if(c.browser.msie){this.ui.focus();this.editorDoc.execCommand("insertImage",false,"#jwysiwyg#");g=this.getElementByAttributeValue("img","src","#jwysiwyg#");if(g){c(g).replaceWith(e)}}else{if(c.browser.mozilla){if(1===c(e).length){f=this.getInternalRange();f.deleteContents();f.insertNode(c(e).get(0))}else{this.editorDoc.execCommand("insertHTML",false,e)}}else{if(!this.editorDoc.execCommand("insertHTML",false,e)){this.editor.focus();this.editorDoc.execCommand("insertHTML",false,e)}}}this.saveContent();return this};this.parseControls=function(){var e=this;c.each(this.options.controls,function(g,f){c.each(f,function(h){if(-1===c.inArray(h,e.availableControlProperties)){throw g+'["'+h+'"]: property "'+h+'" not exists in Wysiwyg.availableControlProperties'}})});if(this.options.parseControls){return this.options.parseControls.call(this)}return this.options.controls};this.removeFormat=function(){if(c.browser.msie){this.ui.focus()}if(this.options.removeHeadings){this.editorDoc.execCommand("formatBlock",false,"<p>")}this.editorDoc.execCommand("removeFormat",false,null);this.editorDoc.execCommand("unlink",false,null);if(c.wysiwyg.rmFormat&&c.wysiwyg.rmFormat.enabled){if("object"===typeof(this.options.plugins.rmFormat.rmMsWordMarkup)){c.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}})}else{c.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:true}}})}}return this};this.ui.removeHoverClass=function(){c(this).removeClass("wysiwyg-button-hover")};this.resetFunction=function(){this.setContent(this.initialContent)};this.saveContent=function(){if(this.viewHTML){return}if(this.original){var f,e;f=this.getContent();if(this.options.rmUnwantedBr){f=f.replace(/<br\/?>$/,"")}if(this.options.replaceDivWithP){e=c("<div/>").addClass("temp").append(f);e.children("div").each(function(){var h=c(this),j=h.find("p"),g;if(0===j.length){j=c("<p></p>");if(this.attributes.length>0){for(g=0;g<this.attributes.length;g+=1){j.attr(this.attributes[g].name,h.attr(this.attributes[g].name))}}j.append(h.html());h.replaceWith(j)}});f=e.html()}c(this.original).val(f);if(this.options.events&&this.options.events.save){this.options.events.save.call(this)}}return this};this.setContent=function(e){this.editorDoc.body.innerHTML=e;this.saveContent();return this};this.triggerControl=function(g,j){var h=j.command||g,f=j["arguments"]||[];if(j.exec){j.exec.apply(this)}else{this.ui.focus();this.ui.withoutCss();try{this.editorDoc.execCommand(h,false,f)}catch(i){a.error(i)}}if(this.options.autoSave){this.autoSaveFunction()}};this.triggerControlCallback=function(e){c(window).trigger("trigger-"+e+".wysiwyg",[this])};this.ui.withoutCss=function(){var f=this.self;if(c.browser.mozilla){try{f.editorDoc.execCommand("styleWithCSS",false,false)}catch(h){try{f.editorDoc.execCommand("useCSS",false,true)}catch(g){}}}return f};this.wrapInitialContent=function(){var e=this.initialContent,f=e.match(/<\/?p>/gi);if(!f){return e}else{}return e}}c.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(f,e,g){return f.each(function(){var h=c(this).data("wysiwyg"),j={},i;if(!h){return this}j[e]=c.extend(true,{visible:true,custom:true},g);c.extend(true,h.options.controls,j);i=c(h.options.toolbarHtml);h.ui.toolbar.replaceWith(i);h.ui.toolbar=i;h.ui.appendControls()})},clear:function(e){return e.each(function(){var f=c(this).data("wysiwyg");if(!f){return this}f.setContent("")})},console:a,destroy:function(e){return e.each(function(){var f=c(this).data("wysiwyg");if(!f){return this}f.destroy()})},document:function(f){var e=f.data("wysiwyg");if(!e){return undefined}return c(e.editorDoc)},getContent:function(f){var e=f.data("wysiwyg");if(!e){return undefined}return e.getContent()},getSelection:function(f){var e=f.data("wysiwyg");if(!e){return undefined}return e.getRangeText()},init:function(f,e){return f.each(function(){var g=c.extend(true,{},e),h;if(("textarea"!==this.nodeName.toLowerCase())||c(this).data("wysiwyg")){return}h=new d();h.init(this,g);c.data(this,"wysiwyg",h);c(h.editorDoc).trigger("afterInit.wysiwyg")})},insertHtml:function(f,e){return f.each(function(){var g=c(this).data("wysiwyg");if(!g){return this}g.insertHtml(e)})},plugin:{listeners:{},bind:function(f){var e=this;c.each(this.listeners,function(k,g){var h,j;for(h=0;h<g.length;h+=1){j=e.parseName(g[h]);c(f.editorDoc).bind(k+".wysiwyg",{plugin:j},function(i){c.wysiwyg[i.data.plugin.name][i.data.plugin.method].apply(c.wysiwyg[i.data.plugin.name],[f])})}})},exists:function(e){var f;if("string"!==typeof(e)){return false}f=this.parseName(e);if(!c.wysiwyg[f.name]||!c.wysiwyg[f.name][f.method]){return false}return true},listen:function(g,e){var f;f=this.parseName(e);if(!c.wysiwyg[f.name]||!c.wysiwyg[f.name][f.method]){return false}if(!this.listeners[g]){this.listeners[g]=[]}this.listeners[g].push(e);return true},parseName:function(e){var f;if("string"!==typeof(e)){return false}f=e.split(".");if(2>f.length){return false}return{name:f[0],method:f[1]}},register:function(e){if(!e.name){a.error("Plugin name missing")}c.each(c.wysiwyg,function(f){if(f===e.name){a.error("Plugin with name '"+e.name+"' was already registered")}});c.wysiwyg[e.name]=e;return true}},removeFormat:function(e){return e.each(function(){var f=c(this).data("wysiwyg");if(!f){return this}f.removeFormat()})},save:function(e){return e.each(function(){var f=c(this).data("wysiwyg");if(!f){return this}f.saveContent()})},selectAll:function(g){var e=g.data("wysiwyg"),f,i,h;if(!e){return this}f=e.editorDoc.body;if(window.getSelection){h=e.getInternalSelection();h.selectAllChildren(f)}else{i=f.createTextRange();i.moveToElementText(f);i.select()}},setContent:function(f,e){return f.each(function(){var g=c(this).data("wysiwyg");if(!g){return this}g.setContent(e)})},triggerControl:function(e,f){return e.each(function(){var g=c(this).data("wysiwyg");if(!g){return this}if(!g.controls[f]){a.error("Control '"+f+"' not exists")}g.triggerControl.apply(g,[f,g.controls[f]])})},support:{prop:b},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(h){var f=this,e,g=[];if(this.extraSafeEntities[1].length===0){c.each(this.extraSafeEntities[0],function(j,k){f.extraSafeEntities[1].push(k.charCodeAt(0))})}e=h.split("");c.each(e,function(j){var k=e[j].charCodeAt(0);if(c.inArray(k,f.extraSafeEntities[1])&&(k<65||k>127||(k>90&&k<97))){g.push("&#"+k+";")}else{g.push(e[j])}});return g.join("")}}};c.wysiwyg.dialog=function(f,h){var j=(f&&f.options&&f.options.dialog)?f.options.dialog:(h.theme?h.theme:"default"),i=new c.wysiwyg.dialog.createDialog(j),g=this,e=c(g);this.options={modal:true,draggable:true,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2000,open:false,close:false};this.isOpen=false;c.extend(this.options,h);this.object=i;this.open=function(){this.isOpen=true;i.init.apply(g,[]);var k=i.show.apply(g,[]);e.trigger("afterOpen",[k])};this.show=function(){this.isOpen=true;e.trigger("beforeShow");var k=i.show.apply(g,[]);e.trigger("afterShow")};this.hide=function(){this.isOpen=false;e.trigger("beforeHide");var k=i.hide.apply(g,[]);e.trigger("afterHide",[k])};this.close=function(){this.isOpen=false;var k=i.hide.apply(g,[]);e.trigger("beforeClose",[k]);i.destroy.apply(g,[]);e.trigger("afterClose",[k])};if(this.options.open){e.bind("afterOpen",this.options.open)}if(this.options.close){e.bind("afterClose",this.options.close)}return this};c.extend(true,c.wysiwyg.dialog,{_themes:{},_theme:"",register:function(e,f){c.wysiwyg.dialog._themes[e]=f},deregister:function(e){delete c.wysiwyg.dialog._themes[e]},createDialog:function(e){return new (c.wysiwyg.dialog._themes[e])},getDimensions:function(){var f=document.body.scrollWidth,e=document.body.scrollHeight;if(c.browser.opera){e=Math.max(c(document).height(),c(window).height(),document.documentElement.clientHeight)}return[f,e]}});c(function(){if(jQuery.ui){c.wysiwyg.dialog.register("jqueryui",function(){var e=this;this._$dialog=null;this.init=function(){var i=this,g=this.options.content;if(typeof g==="object"){if(typeof g.html==="function"){g=g.html()}else{if(typeof g.toString==="function"){g=g.toString()}}}e._$dialog=c("<div></div>").attr("title",this.options.title).html(g);var f=this.options.height=="auto"?300:this.options.height,h=this.options.width=="auto"?450:this.options.width;e._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:f,width:h});return e._$dialog};this.show=function(){e._$dialog.dialog("open");return e._$dialog};this.hide=function(){e._$dialog.dialog("close");return e._$dialog};this.destroy=function(){e._$dialog.dialog("destroy");return e._$dialog}})}c.wysiwyg.dialog.register("default",function(){var e=this;this._$dialog=null;this.init=function(){var l=this,i=this.options.content;if(typeof i==="object"){if(typeof i.html==="function"){i=i.html()}else{if(typeof i.toString==="function"){i=i.toString()}}}e._$dialog=c('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var h=c('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>");var f=c('<a href="#" class="wysiwyg-dialog-close-button">X</a>');f.click(function(){l.close()});h.find(".wysiwyg-dialog-close-wrapper").prepend(f);var k=c('<div class="wysiwyg-dialog-content">'+i+"</div>");e._$dialog.append(h).append(k);var g=this.options.height=="auto"?300:this.options.height,j=this.options.width=="auto"?450:this.options.width;e._$dialog.hide().css({width:j,height:g,left:((c(window).width()-j)/2),top:((c(window).height()-g)/3)});c("body").append(e._$dialog);return e._$dialog};this.show=function(){if(this.options.modal){var g=c.wysiwyg.dialog.getDimensions(),h=c('<div class="wysiwyg-dialog-modal-div"></div>').css({width:g[0],height:g[1]});e._$dialog.wrap(h)}if(this.options.draggable){var f=false;e._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(l){l.preventDefault();c(this).css({cursor:"move"});var j=c(this),k=c(this).parents(".wysiwyg-dialog"),i=(l.pageX-parseInt(k.css("left"),10)),m=(l.pageY-parseInt(k.css("top"),10));f=true;c(this).css({cursor:"move"});c(document).bind("mousemove",function(n){n.preventDefault();if(f){k.css({top:(n.pageY-m),left:(n.pageX-i)})}}).bind("mouseup",function(n){n.preventDefault();f=false;j.css({cursor:"auto"});c(document).unbind("mousemove").unbind("mouseup")})})}e._$dialog.show();return e._$dialog};this.hide=function(){e._$dialog.hide();return e._$dialog};this.destroy=function(){if(this.options.modal){e._$dialog.unwrap()}if(this.options.draggable){e._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown")}e._$dialog.remove();return e._$dialog}})});c.fn.wysiwyg=function(g){var e=arguments,f;if("undefined"!==typeof c.wysiwyg[g]){e=Array.prototype.concat.call([e[0]],[this],Array.prototype.slice.call(e,1));return c.wysiwyg[g].apply(c.wysiwyg,Array.prototype.slice.call(e,1))}else{if("object"===typeof g||!g){Array.prototype.unshift.call(e,this);return c.wysiwyg.init.apply(c.wysiwyg,e)}else{if(c.wysiwyg.plugin.exists(g)){f=c.wysiwyg.plugin.parseName(g);e=Array.prototype.concat.call([e[0]],[this],Array.prototype.slice.call(e,1));return c.wysiwyg[f.name][f.method].apply(c.wysiwyg[f.name],Array.prototype.slice.call(e,1))}else{a.error("Method '"+g+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins")}}}};c.fn.getWysiwyg=function(){return this.data("wysiwyg")}})(jQuery);(function(b){var a;a=function(){var f=a.makeArray(arguments);if(f.length==0){alert("No arguments - no supported");return null}var e=f[0];var v=null;var k=null;var o=null;var n=null;var l=null;var g=null;var m=null;var c=null;var j=false;if(f.length==1){var p=b(e).find(":first");var d=null;for(var s=0;s<p.length;s++){var u=p[s];var r=b(u).attr("alpaca-field-id");if(r){var q=a.fieldInstances[r];if(q){d=q}}}if(d!=null){return d}else{var h=b(e).html();b(e).html("");v=h}}if(f.length>=2){if(a.isObject(f[1])){v=f[1].data;o=f[1].schema;k=f[1].options;n=f[1].view;l=f[1].render;g=f[1].postRender;m=f[1].error;c=f[1].connector;if(!a.isEmpty(f[1].notTopLevel)){j=f[1].notTopLevel}}else{v=f[1];if(a.isFunction(v)){v=v()}}}if(a.isEmpty(m)){m=function(i){alert(i.message)}}if(a.isEmpty(c)){c=new a.Connector("default")}if(a.isEmpty(v)){if(a.isEmpty(o)&&(a.isEmpty(k)||a.isEmpty(k.type))){if(a.isEmpty(k)){v="";k="text"}else{if(k&&a.isObject(k)){v="";k.type="text"}}}}if(e){if(a.isString(e)){e=b("#"+e)}}var t=c;if(j){t=new a.Connector("default")}t.loadAll({data:v,options:k,schema:o,view:n},function(i,w,y,z){return a.init(e,i,w,y,z,l,g,c,m)},function(i){m(i);return null})};a.Fields={};a.Connectors={};b.extend(a,{VERSION:"0.1.0",makeArray:function(c){return Array.prototype.slice.call(c)},isFunction:function(c){return Object.prototype.toString.call(c)==="[object Function]"},isString:function(c){return(typeof c=="string")},isObject:function(c){return b.isPlainObject(c)},isNumber:function(c){return(typeof c=="number")},isArray:function(c){return Object.prototype.toString.call(c)==="[object Array]"},isBoolean:function(c){return(typeof c=="boolean")},isUndefined:function(c){return(typeof c=="undefined")},isEmpty:function(c){return a.isUndefined(c)||c==null},spliceIn:function(c,d,e){return c.substring(0,d)+e+c.substring(d,c.length)},compactArray:function(c){var f=[],d=c.length,e;for(e=0;e<d;e++){if(!lang.isNull(c[e])&&!lang.isUndefined(c[e])){f.push(c[e])}}return f},removeAccents:function(c){return c.replace(/[]/g,"a").replace(/[]/g,"e").replace(/[]/g,"i").replace(/[]/g,"o").replace(/[]/g,"u").replace(/[]/g,"y").replace(/[]/g,"n").replace(/[]/g,"c").replace(/[]/g,"oe").replace(/[]/g,"ae")},indexOf:function(g,c,f){var d=c.length,e;if(!a.isFunction(f)){f=function(h,i){return h===i}}for(e=0;e<d;e++){if(f.call({},g,c[e])){return e}}return -1},log:function(c){if(!(typeof console=="undefined")){console.log(c)}},uniqueIdCounter:0,defaultLocale:"en_US",setDefaultLocale:function(c){this.defaultLocale=c},defaultSchemaFieldMapping:{},registerDefaultSchemaFieldMapping:function(d,c){if(d&&c){this.defaultSchemaFieldMapping[d]=c}},defaultFormatFieldMapping:{},registerDefaultFormatFieldMapping:function(d,c){if(d&&c){this.defaultFormatFieldMapping[d]=c}},getSchemaType:function(c){if(a.isEmpty(c)){return"string"}if(a.isObject(c)){return"object"}if(a.isString(c)){return"string"}if(a.isNumber(c)){return"number"}if(a.isArray(c)){return"array"}if(a.isBoolean(c)){return"boolean"}if(typeof c=="object"){return"object"}},views:{},viewIdPrefix:"VIEW::",isValidViewId:function(c){return a.startsWith(c,this.viewIdPrefix)},generateViewId:function(){return this.viewIdPrefix+"VIEW_"+this.generateId()},registerView:function(c){var h=c.id;if(!a.isEmpty(h)&&this.isValidViewId(h)){if(this.views[h]){var e=this.views[h];if(c.description){e.description=c.description}if(c.type){e.type=c.type}if(c.id){e.id=c.id}if(c.templates){if(!e.templates){e.templates={}}a.merge(e.templates,c.templates)}if(c.messages){if(!e.messages){e.messages={}}a.merge(e.messages,c.messages)}}else{this.views[h]=c}var d=a.cloneObject(c.templates);for(var f in d){var g=c.templates[f];if(a.isString(g)&&!a.startsWith(g,c.id)){c.templates[c.id+"_"+f+"_src"]=g;if(g&&!a.isUri(g)){b.template(c.id+"_"+f,g);c.templates[f]=c.id+"_"+f}else{c.templates[f]=g}}}}else{alert("Invalid View ID (must starts with "+this.viewIdPrefix+")")}return h},defaultView:"VIEW::WEB_EDIT",getView:function(c){if(c&&this.views.hasOwnProperty(c)){return this.views[c]}else{return this.views[this.defaultView]}},getViewType:function(c){if(a.isString(c)){c=this.getView(c)}if(a.isObject(c)){if(c.type){return c.type}else{if(c.parent){return this.getViewType(c.parent)}else{return null}}}},setDefaultView:function(c){if(c&&this.views.hasOwnProperty(c)){this.defaultView=c}},registerTemplate:function(e,f,c){var d=this.getView(c);if(!d){if(c){d=this.views[c]={}}else{d=this.views[this.defaultView]={}}}if(d){if(!d.templates){d.templates={}}if(f&&!a.isUri(f)){b.template(d.id+"_"+e,f);d.templates[e]=d.id+"_"+e}else{d.templates[e]=f}}},registerTemplates:function(e,c){for(var d in e){this.registerTemplate(d,e[d],c)}},registerMessage:function(e,f,c){var d=this.getView(c);if(!d){if(c){this.views[c]={};d=this.views[c]}else{this.views[this.defaultView]={};d=this.views[this.defaultView]}}if(d){if(!d.messages){d.messages={}}d.messages[e]=f}},registerMessages:function(e,c){for(var d in e){if(e.hasOwnProperty(d)){this.registerMessage(d,e[d],c)}}},fieldTemplatePostfix:{controlFieldMessageContainer:"-controlfield-message-container",controlFieldLabel:"-controlfield-label",controlFieldContainer:"-controlfield-container",controlFieldHelper:"-controlfield-helper",fieldSetLegend:"-fieldset-legend",fieldSetItemsContainer:"-fieldset-items-container",fieldSetHelper:"-fieldset-helper",fieldSetOuterEl:"-fieldset",formButtonsContainer:"-form-buttons-container",formFieldsContainer:"-form-fields-container"},fieldTemplate:function(e,d,g){if(!d){d="controlFieldLabel"}var f=this.getTemplate(d,e.data);if(g){if(this.getTemplate(f+"_src",e.data)){f=this.getTemplate(f+"_src",e.data)}if(b(".alpaca"+this.fieldTemplatePostfix[d],b(f)).length==0){if(this.fieldTemplatePostfix[d]){f=b(f).addClass("alpaca"+this.fieldTemplatePostfix[d]).outerHTML(true)}else{f=b(f).outerHTML(true)}}return f}else{var c=b.tmpl(f,e.data);if(c){if(this.fieldTemplatePostfix[d]){if(b(".alpaca"+this.fieldTemplatePostfix[d],c).length==0){c.addClass("alpaca"+this.fieldTemplatePostfix[d])}if(!c.attr("id")){c.attr("id",e.data.id+this.fieldTemplatePostfix[d])}}return c.outerHTML(true)}else{return""}}},getTemplate:function(d,f){var c=f.view;if(a.isObject(c)){var e=this._getTemplate(d,c,f.path);if(!a.isEmpty(e)){return e}c=this.defaultView}if(a.isString(c)){c=this.getView(c);return this._getTemplate(d,c,f.path)}return null},_getTemplate:function(d,c,e){if(c&&c.fields&&c.fields[e]&&c.fields[e].templates&&c.fields[e].templates[d]){return c.fields[e].templates[d]}if(c&&c.templates&&c.templates[d]){return c.templates[d]}else{if(c&&c.parent){return this._getTemplate(d,this.views[c.parent],e)}else{return null}}},defaultDateFormat:"mm/dd/yy",regexps:{email:/^[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+(?:\.[a-z0-9!\#\$%&'\*\-\/=\?\+\-\^_`\{\|\}~]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z]{2,6}$/i,url:/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(\:[0-9]{1,5})?(([0-9]{1,5})?\/.*)?$/i,password:/^[0-9a-zA-Z\x20-\x7E]*$/,date:/^(0[1-9]|1[012])[- /.](0[1-9]|[12][0-9]|3[01])[- /.]\d\d$/,integer:/^([\+\-]?([1-9]\d*)|0)$/,number:/^([\+\-]?((([0-9]+(\.)?)|([0-9]*\.[0-9]+))([eE][+-]?[0-9]+)?))$/,phone:/^(\D?(\d{3})\D?\D?(\d{3})\D?(\d{4}))?$/,ipv4:/^(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)(?:\.(?:1\d?\d?|2(?:[0-4]\d?|[6789]|5[0-5]?)?|[3-9]\d?|0)){3}$/},fieldInstances:{},fieldClassRegistry:{},registerFieldClass:function(c,d){this.fieldClassRegistry[c]=d},getFieldClass:function(c){return this.fieldClassRegistry[c]},getFieldClassType:function(d){for(var c in this.fieldClassRegistry){if(this.fieldClassRegistry.hasOwnProperty(c)){if(this.fieldClassRegistry[c]==d){return c}}}return null},connectorClassRegistry:{},registerConnectorClass:function(d,c){this.connectorClassRegistry[d]=c},getConnectorClass:function(c){return this.connectorClassRegistry[c]},replaceAll:function(e,c,d){return e.replace(new RegExp(c,"g"),d)},element:function(c,e,d,g){var f=b("<"+c+"/>");if(e){f.attr(e)}if(d){f.css(d)}if(g){for(className in g){f.addClass(className)}}},elementFromTemplate:function(d,e){var c=d;if(e){for(x in e){c=a.replaceAll(c,"${"+x+"}",e[x])}}return b(c)},generateId:function(){a.uniqueIdCounter++;return"alpaca"+a.uniqueIdCounter},later:function(l,e,n,h,i){l=l||0;e=e||{};var g=n,k=b.makeArray(h),j,c;if(typeof n==="string"){g=e[n]}if(!g){throw {name:"TypeError",message:"The function is undefined."}}j=function(){g.apply(e,k)};c=(i)?setInterval(j,l):setTimeout(j,l);return{id:c,interval:i,cancel:function(){if(this.interval){clearInterval(c)}else{clearTimeout(c)}}}},endsWith:function(d,c){return d.indexOf(c,d.length-c.length)!==-1},startsWith:function(d,c){return d.substr(0,c.length)===c},isUri:function(c){return a.isString(c)&&(a.startsWith(c,"http://")||a.startsWith(c,"https://")||a.startsWith(c,"/")||a.startsWith(c,"./")||a.startsWith(c,"../"))},traverseObject:function(c,g,f){if(a.isString(g)){g=g.split(".")}var e=null;var h=c;var d=null;do{d=g.shift();if(f&&d==f){d=g.shift()}if(!a.isEmpty(h[d])){h=h[d];if(g.length==0){e=h}}else{g=[]}}while(g.length>0);return e},each:function(f,e){if(a.isArray(f)){for(var d=0;d<f.length;d++){e.apply(f[d])}}else{if(a.isObject(f)){for(var c in f){e.apply(f[c])}}}},merge:function(g,f,d){if(!g){g={}}for(var c in f){var e=true;if(d){e=d(c)}if(e){if(a.isEmpty(f[c])){g[c]=f[c]}else{if(a.isObject(f[c])){if(!g[c]){g[c]={}}g[c]=a.merge(g[c],f[c])}else{g[c]=f[c]}}}}return g},mergeObject:function(e,d){if(!e){e={}}for(var c in d){if(!a.isFunction(d[c])){if(a.isValEmpty(d[c])){if(!a.isEmpty(e[c])){e[c]=d[c]}}else{if(a.isObject(d[c])){if(!e[c]){e[c]={}}e[c]=a.mergeObject(e[c],d[c])}else{e[c]=d[c]}}}}return e},cloneObject:function(d){var e;if(a.isObject(d)){e={};for(var c in d){if(d.hasOwnProperty(c)){if(a.isObject(d[c])||a.isArray(d[c])){e[c]=a.cloneObject(d[c])}else{e[c]=d[c]}}}}else{if(a.isArray(d)){e=[];for(var c=0;c<d.length;c++){if(a.isObject(d[c])||a.isArray(d[c])){e.push(a.cloneObject(d[c]))}else{e.push(d[c])}}}else{e=d}}return e},substituteTokens:function(h,d){if(!a.isEmpty(h)){for(var g=0;g<d.length;g++){var f="{"+g+"}";var c=h.indexOf(f);if(c>-1){var e=h.substring(0,c)+d[g]+h.substring(c+3);h=e}}}return h},compareObject:function(d,c){return equiv(d,c)},compareArrayContent:function(d,c){var e=d&&c&&(d.length==c.length);if(e){b.each(d,function(g,f){if(!e){return false}if(b.inArray(f,c)==-1){e=false}else{e=true}})}return e},isValEmpty:function(d){var c=false;if(a.isEmpty(d)){c=true}else{if(a.isString(d)&&d==""){c=true}if(a.isObject(d)&&b.isEmptyObject(d)){c=true}if(a.isArray(d)&&d.length==0){c=true}if(a.isNumber(d)&&isNaN(d)){c=true}}return c},init:function(c,f,l,e,i,k,h,d,g){var j=a.createFieldInstance(c,f,l,e,i,d,g);a.fieldInstances[j.getId()]=j;if(a.isEmpty(k)){k=j.view.render}if(a.isEmpty(h)){h=j.view.postRender}if(k!=null){k(j,h)}else{j.render(h)}j.callback=k;j.renderedCallback=h;return j},createFieldInstance:function(c,f,k,e,j,d,g){if(a.isValEmpty(k)){k={}}if(a.isValEmpty(e)){e={}}if(k&&a.isString(k)){var h=k;k={};k.type=h}if(!k.type){if(!e.type){e.type=a.getSchemaType(f)}if(e&&e["enum"]){if(e["enum"].length>3){k.type="select"}else{k.type="radio"}}else{k.type=a.defaultSchemaFieldMapping[e.type]}if(e.format&&a.defaultFormatFieldMapping[e.format]){k.type=a.defaultFormatFieldMapping[e.format]}}var i=a.getFieldClass(k.type);if(!i){g({message:"Unable to find field class for type: "+k.type,reason:"FIELD_INSTANTIATION_ERROR"});return null}return new i(c,f,k,e,j,d)}});b.alpaca=window.Alpaca=a;b.fn.alpaca=function(){var d=a.makeArray(arguments);var c=[].concat(this,d);return a.apply(this,c)};b.fn.outerHTML=function(c){if(c){return b("<div></div>").append(this).html()}else{return b("<div></div>").append(this.clone()).html()}};b.fn.swapWith=function(c){return this.each(function(){var d=b(c).clone();var e=b(this).clone();b(c).replaceWith(e);b(this).replaceWith(d)})};b.fn.filestyle=function(c){var d={width:250};if(c){b.extend(d,c)}return this.each(function(){var f=this;var h=b("<div>").addClass("alpaca-filefield-button");var e=b("<input/>").addClass("alpaca-filefield-control").addClass(b(f).attr("class"));var g=e.width;b(f).before(e);b(f).wrap(h);b(f).css({position:"relative",height:h.css("height"),width:d.width+"px",display:"inline",cursor:"pointer",opacity:"0.0"});if(b.browser.mozilla){if(/Win/.test(navigator.platform)){b(f).css("margin-left","-142px")}else{b(f).css("margin-left","-168px")}}else{b(f).css("margin-left",h.width-g+"px")}b(f).bind("change",function(){e.val(b(f).val())})})};b.fn.customFileInput=function(){return b(this).each(function(){var e=b(this).addClass("alpaca-controlfield-file-custom-input").focus(function(){e.data("val",e.val())}).blur(function(){b(this).trigger("checkChange")}).bind("disable",function(){e.attr("disabled",true);d.addClass("alpaca-controlfield-file-custom-disabled")}).bind("enable",function(){e.removeAttr("disabled");d.removeClass("alpaca-controlfield-file-custom-disabled")}).bind("checkChange",function(){if(e.val()&&e.val()!=e.data("val")){e.trigger("change")}}).bind("change",function(){var j=b(this).val().split(/\\/).pop();var i="customfile-ext-"+j.split(".").pop().toLowerCase();f.text(j).data("fileExt",i);b(".ui-icon",f.parent()).remove();var h=j.split(".").pop().toLowerCase();var g="ui-icon-document";if(h=="jpg"||h=="gif"||h=="png"||h=="jpeg"||h=="bmp"){g="ui-icon-image"}if(h=="mp3"||h=="mp4"||h=="swf"||h=="mov"||h=="wav"||h=="m4v"){g="ui-icon-video"}if(h=="json"||h=="js"){g="ui-icon-script"}f.before('<span class="ui-icon '+g+'" style="float:left;margin-top:0.3em"></span>')}).click(function(){e.data("val",e.val());setTimeout(function(){e.trigger("checkChange")},100)});var d=b('<div class="ui-widget-header ui-corner-all alpaca-controlfield-file-custom"></div>');var c=b('<span class="" aria-hidden="true" style="float:right">Browse...</span>').button({text:true}).appendTo(d);var f=b('<span class="alpaca-controlfield-file-custom-feedback" aria-hidden="true">No file selected...</span>').appendTo(d);if(e.is("[disabled]")){e.trigger("disable")}d.mousemove(function(g){e.css({left:g.pageX-d.offset().left-e.outerWidth()+20,top:g.pageY-d.offset().top-b(window).scrollTop()-3})}).insertAfter(e);e.appendTo(d);d.wrap("<small/>")})}})(jQuery);(function(b){var a=b.alpaca;a.registerView({id:"VIEW::WEB_DISPLAY",title:"Default Web Display View",description:"Default web edit view which goes though field hierarchy.",type:"view",platform:"web",displayReadonly:true,templates:{controlField:'<div class="alpaca-data-container">{{if options.label}}<div class="alpaca-data-label">${options.label}</div>{{/if}}<div class="alpaca-data">&nbsp;${data}</div></div>',fieldSetOuterEl:'<div class="ui-widget ui-widget-content">{{html this.html}}</div>',fieldSetLegend:'{{if options.label}}<div class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</div>{{/if}}',fieldSetItemsContainer:"<div>{{html this.html}}</div>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}'}});a.registerView({id:"VIEW::WEB_EDIT",title:"Default Web Edit View",description:"Default web edit view which goes though field hierarchy.",type:"edit",platform:"web",displayReadonly:true,templates:{controlFieldOuterEl:"<span>{{html this.html}}</span>",controlFieldMessage:'<div><span class="ui-icon ui-icon-alert"></span><span class="alpaca-controlfield-message-text">${message}</span></div>',controlFieldLabel:'{{if options.label}}<div class="{{if options.labelClass}}${options.labelClass}{{/if}}"><div>${options.label}</div></div>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}"><span class="ui-icon ui-icon-info"></span><span class="alpaca-controlfield-helper-text">${options.helper}</span></div>{{/if}}',controlFieldContainer:"<div>{{html this.html}}</div>",controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}{{/wrap}}',fieldSetOuterEl:"<fieldset>{{html this.html}}</fieldset>",fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:"<div>{{html this.html}}</div>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>",formFieldsContainer:"<div>{{html this.html}}</div>",formButtonsContainer:"<div>{{html this.html}}</div>",form:'<form>{{html Alpaca.fieldTemplate(this,"formFieldsContainer")}}{{html Alpaca.fieldTemplate(this,"formButtonsContainer")}}</form>',wizardStep:'<div class="alpaca-clear"></div>',wizardNavBar:"<div></div>",wizardPreButton:"<button>Back</button>",wizardNextButton:"<button>Next</button>",wizardStatusBar:'<ol id="${id}">{{each(i,v) titles}}<li id="stepDesc${i}"><div><strong><span>${v.title}</span>${v.description}</strong></div></li>{{/each}}</ol>'},messages:{empty:"",required:"This field is required",valid:"",invalid:"This field is invalid",months:["January","February","March","April","May","June","July","August","September","October","November","December"],timeUnits:{SECOND:"seconds",MINUTE:"minutes",HOUR:"hours",DAY:"days",MONTH:"months",YEAR:"years"}}});a.registerView({id:"VIEW::WEB_CREATE",parent:"VIEW::WEB_EDIT",title:"Default Web Create View",description:"Default web create view which doesn't bind initial data.",type:"create",displayReadonly:false})})(jQuery);(function(b){var a=b.alpaca;a.registerView({id:"VIEW::WEB_EDIT_LIST",parent:"VIEW::WEB_EDIT",title:"Web Edit View List Style",description:"Web edit view based on list styles.",type:"edit",displayReadonly:true,collapsible:true,legendStyle:"link",templates:{controlFieldOuterEl:'<span class="alpaca-view-web-edit-list">{{html this.html}}</span>',controlFieldMessage:'<div><span class="ui-icon ui-icon-alert"></span><span class="alpaca-controlfield-message-text">${message}</span></div>',controlFieldLabel:'{{if options.label}}<label for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</label>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}"><span class="ui-icon ui-icon-info"></span><span class="alpaca-controlfield-helper-text">${options.helper}</span></div>{{/if}}',controlFieldContainer:"<div>{{html this.html}}</div>",controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}{{/wrap}}',fieldSetOuterEl:'<fieldset class="alpaca-view-web-edit-list">{{html this.html}}</fieldset>',fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:"<ol>{{html this.html}}</ol>",fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:'<li style="list-style:none;"></li>',itemLabel:'{{if options.itemLabel}}<label for="${id}" class="alpaca-controlfield-label" style="width:100px;display:inline-block;vertical-align:top;padding-top:0.5em;"><span style="width:100px;display:inline-block;vertical-align:top;;padding-top:0.25em">${options.itemLabel}{{if index}} <span class="alpaca-item-label-counter">${index}</span></span>{{/if}}</label>{{/if}}'},styles:{},fields:{"/":{templates:{fieldSetOuterEl:'<fieldset style="border:none">{{html this.html}}</fieldset>',fieldSetMessage:'<div><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span><span>${message}</span></div>',fieldSetLegend:'{{if options.label}}<legend class="{{if options.labelClass}}${options.labelClass}{{/if}}" style="padding-top:2em;border:none;">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',fieldSetItemsContainer:'<ol style="padding-left :0;">{{html this.html}}</ol>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:'<li style="list-style:none;"></li>'}}}})})(jQuery);(function(b){var a=b.alpaca;a.registerView({id:"VIEW::MOBILE_DISPLAY",parent:"VIEW::WEB_DISPLAY",title:"Mobile DISPLAY View",description:"Mobile display view using JQuery Mobile Library",type:"view",platform:"mobile",legendStyle:"link",toolbarStyle:"link",buttonType:"link",templates:{controlField:'<ul data-role="listview"><li>{{if options.label}}<h4>${options.label}</h4>{{/if}}<p><strong>${data}</strong></p></li></ul>',fieldSetOuterEl:'<fieldset data-role="collapsible" id="${id}">{{html this.html}}</fieldset>',fieldSetMessage:"<div>* ${message}</div>",fieldSetLegend:'{{if options.label}}<legend for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<h3 class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</h3>{{/if}}',fieldSetItemsContainer:'<div data-role="controlgroup">{{html this.html}}</div>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>"},messages:{required:"Required Field",invalid:"Invalid Field"},render:function(c,d){if(c.container.attr("id").indexOf("-mobile-page")==-1){b('<div data-role="page" data-header="'+c.container.attr("data-header")+'" data-theme="'+c.container.attr("data-theme")+'" id="'+c.id+'-mobile-page"><div data-role="header" data-theme="'+c.container.attr("data-theme")+'"><h1>'+c.container.attr("data-header")+"</h1></div></div>").hide().appendTo(c.container);c.container=b("#"+c.id+"-mobile-page",c.container)}else{}c.render(d)},postRender:function(c){c.container.page().show();c.container.find(".ui-select").find('[role="button"]').addClass("ui-corner-all");b(".ui-collapsible-heading",c.container).css("margin","0")}});a.registerView({id:"VIEW::MOBILE_EDIT",parent:"VIEW::WEB_EDIT",title:"Mobile Edit View",description:"Mobile edit view using JQuery Mobile Library",type:"edit",platform:"mobile",legendStyle:"link",toolbarStyle:"link",buttonType:"link",templates:{controlFieldOuterEl:'<div data-role="fieldcontain">{{html this.html}}</div>',controlFieldMessage:"<div>* ${message}</div>",controlFieldLabel:'{{if options.label}}<label for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</label>{{/if}}',controlFieldHelper:'{{if options.helper}}<div class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</div>{{/if}}',controlFieldContainer:'<div data-replace="true">{{html this.html}}</div>',controlField:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"controlFieldLabel")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"controlFieldContainer",true)}}{{/wrap}}{{html Alpaca.fieldTemplate(this,"controlFieldHelper")}}{{/wrap}}',fieldSetOuterEl:'<fieldset data-role="collapsible" id="${id}">{{html this.html}}</fieldset>',fieldSetMessage:"<div>* ${message}</div>",fieldSetLegend:'{{if options.label}}<legend for="${id}" class="{{if options.labelClass}}${options.labelClass}{{/if}}">${options.label}</legend>{{/if}}',fieldSetHelper:'{{if options.helper}}<h3 class="{{if options.helperClass}}${options.helperClass}{{/if}}">${options.helper}</h3>{{/if}}',fieldSetItemsContainer:'<div data-role="controlgroup">{{html this.html}}</div>',fieldSet:'{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetOuterEl",true)}}{{html Alpaca.fieldTemplate(this,"fieldSetLegend")}}{{html Alpaca.fieldTemplate(this,"fieldSetHelper")}}{{wrap(null, {}) Alpaca.fieldTemplate(this,"fieldSetItemsContainer",true)}}{{/wrap}}{{/wrap}}',fieldSetItemContainer:"<div></div>",formFieldsContainer:'<div data-role="content">{{html this.html}}</div>',formButtonsContainer:'<fieldset class="ui-grid-a">{{html this.html}}</fieldset>',form:'<form>{{html Alpaca.fieldTemplate(this,"formFieldsContainer")}}{{html Alpaca.fieldTemplate(this,"formButtonsContainer")}}</form>',controlFieldRadio:'<fieldset data-role="controlgroup" id="${id}">{{each selectOptions}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${formName}" id="${id}-${$index}}" value="${value}" {{if value == data}}checked="checked"{{/if}}/><label for="${id}-${$index}}">${text}</label>{{/each}}</fieldset>',controlFieldCheckbox:'<fieldset data-role="controlgroup" id="${id}-0"><input type="checkbox" id="${id}-1" name="${id}-1" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each options.data}}data-${fieldId}="${value}"{{/each}}/>{{if options.rightLabel}}<label for="${id}-1">${options.rightLabel}</label>{{else}}{{if options.label}}<label for="${id}-1">${options.label}?</label>{{/if}}{{/if}}</fieldset>',arrayItemToolbar:'<div class="alpaca-fieldset-array-item-toolbar" data-role="controlgroup" data-type="horizontal"><span class="alpaca-fieldset-array-item-toolbar-add" data-role="button" data-icon="add" data-iconpos="notext">Add</span><span class="alpaca-fieldset-array-item-toolbar-remove" data-role="button" data-icon="delete" data-iconpos="notext">Delete</span><span class="alpaca-fieldset-array-item-toolbar-up" data-role="button" data-icon="arrow-u" data-iconpos="notext">Up</span><span class="alpaca-fieldset-array-item-toolbar-down" data-role="button" data-icon="arrow-d" data-iconpos="notext">Down</span></div>',arrayToolbar:'<div class="alpaca-fieldset-array-toolbar" data-role="controlgroup"><span class="alpaca-fieldset-array-toolbar-icon alpaca-fieldset-array-toolbar-add" data-role="button" data-icon="add" data-inline="true" title="Add">Add</span></div>'},messages:{required:"Required Field",invalid:"Invalid Field"},render:function(c,d){if(c.container.attr("id").indexOf("-mobile-page")==-1){b('<div data-role="page" data-header="'+c.container.attr("data-header")+'" data-theme="'+c.container.attr("data-theme")+'" id="'+c.id+'-mobile-page"><div data-role="header" data-theme="'+c.container.attr("data-theme")+'"><h1>'+c.container.attr("data-header")+"</h1></div></div>").hide().appendTo(c.container);c.container=b("#"+c.id+"-mobile-page",c.container)}else{}c.render(d)},postRender:function(c){c.container.page().show();c.container.find(".ui-select").find('[role="button"]').addClass("ui-corner-all");b(".ui-collapsible-heading",c.container).css("margin","0")}})})(jQuery);(function(b){var a=b.alpaca;a.registerView({id:"VIEW::WEB_EDIT",templates:{twoColumnLayout:'<div class="alpaca-layout-two-column-mask">{{if options.label}}<h3>${options.label}</h3>{{/if}}{{if options.helper}}<h4>${options.helper}</h4>{{/if}}<div class="alpaca-layout-two-column-left alpaca-layout-region"  id="leftcolumn"></div><div class="alpaca-layout-two-column-right alpaca-layout-region" id="rightcolumn"></div></div>'}});a.registerView({id:"VIEW::WEB_EDIT_LAYOUT_TWO_COLUMN",parent:"VIEW::WEB_EDIT",title:"Web Edit View with Two-Column Layout",description:"Web edit default view with two-column layout.",layout:{template:"twoColumnLayout"}});a.registerView({id:"VIEW::WEB_EDIT_LIST_LAYOUT_TWO_COLUMN",parent:"VIEW::WEB_EDIT_LIST",title:"Web List Edit View with Two-Column Layout",description:"Web edit list view with two-column layout.",layout:{template:"twoColumnLayout"}})})(jQuery);(function(b){var a=b.alpaca;a.View=Base.extend({constructor:function(c,d){this.field=d;this.setView(c)},setView:function(c){this.viewObject=a.isObject(c)?c:a.getView(c);if(a.isObject(c)&&a.isEmpty(this.viewObject.parent)&&a.isEmpty(this.viewObject.id)){this.viewObject.parent=a.defaultView;if(this.getGlobalTemplate()){this.viewObject.parent="VIEW::WEB_DISPLAY"}}this.id=this.viewObject.id;this.parent=this.viewObject.parent;this.type=this.getViewParam("type");this.displayReadonly=this.getViewParam("displayReadonly");this.platform=this.getViewParam("platform");this.device=this.getViewParam("device");this.render=this.getViewParam("render");this.postRender=this.getViewParam("postRender");this.collapsible=this.getViewParam("collapsible");this.legendStyle=this.getViewParam("legendStyle");this.toolbarStyle=this.getViewParam("toolbarStyle");this.buttonStyle=this.getViewParam("buttonStyle")},getWizard:function(){return this.getViewParam("wizard")},getGlobalTemplate:function(){var d=this.getViewParam("globalTemplate");var c=this.getTemplate(d);if(!a.isEmpty(c)){d=c}return d},getLayout:function(){var d=this.getViewParam(["layout","template"],true);var c=this.getTemplate(d);if(!a.isEmpty(c)){d=c}return{template:d,bindings:this.getViewParam(["layout","bindings"],true)}},getStyles:function(){var c=[];var e=this.viewObject;while(e){c.push(e);e=a.views[e.parent]}var f={};for(var d=c.length-1;d>=0;d--){if(c[d].styles){a.mergeObject(f,c[d].styles)}if(this.field.path&&c[d].fields&&c[d].fields[this.field.path]&&c[d].fields[this.field.path].styles){a.mergeObject(f,c[d].fields[this.field.path].styles)}}return f},getTemplate:function(d){var c=this.getViewParam(["templates",d]);if(b(c)[0]&&b(c)[0].tagName.toLowerCase()=="script"&&b(c).attr("type")=="text/x-jquery-tmpl"){c=b(c).html()}return c},getMessage:function(c){var d=this.getViewParam(["messages",a.defaultLocale,c]);return a.isEmpty(d)?this.getViewParam(["messages",c]):d},getViewParam:function(f,d){var c=this.field.path;if(this.viewObject.fields&&this.viewObject.fields[c]){var e=this._getConfigVal(this.viewObject.fields[c],f);if(!a.isEmpty(e)){return e}}if(c&&c.indexOf("[")!=-1&&c.indexOf("]")!=-1){c=c.replace(/\[\d+\]/g,"[*]");if(this.viewObject.fields&&this.viewObject.fields[c]){var e=this._getConfigVal(this.viewObject.fields[c],f);if(!a.isEmpty(e)){return e}}}if(!a.isEmpty(d)&&d&&this.field.path!="/"){return null}return this._getViewParam(this.viewObject,f)},_getViewParam:function(c,e){var d=this._getConfigVal(c,e);if(c&&!a.isEmpty(d)){return d}else{if(c&&c.parent){return this._getViewParam(a.views[c.parent],e)}else{return null}}},_getConfigVal:function(d,e){if(a.isArray(e)){for(var c=0;c<e.length&&!a.isEmpty(d);c++){d=d[e[c]]}}else{d=d[e]}return d}})})(jQuery);(function(b){var a=b.alpaca;a.Field=Base.extend({constructor:function(e,i,g,h,d,c,f){this.initializing=true;this.container=e;this.parent=null;this.data=i;this.options=g;this.schema=h;this.connector=c;this.errorCallback=f;this.singleLevelRendering=false;this.view=new a.View(d,this);if(!this.options){this.options={}}this.id=this.options.id;this.type=this.options.type;if(!this.id){this.id=a.generateId()}if(!this.schema){this.schema={}}if(!this.options.label&&this.schema.title){this.options.label=this.schema.title}if(!this.options.helper&&this.schema.description){this.options.helper=this.schema.description}if(a.isEmpty(this.options.readonly)&&!a.isEmpty(this.schema.readonly)){this.options.readonly=this.schema.readonly}if(a.isValEmpty(this.data)&&!a.isEmpty(this.schema["default"])){this.data=this.schema["default"]}this.path="/";this.validation={};this.backupData=a.cloneObject(this.data)},getDefaultFieldTemplateId:function(){return"controlField"},setDefaultTemplate:function(){var d=this.view.getGlobalTemplate();var c=this.view.getLayout().template;if(d){this.setTemplate(d);this.singleLevelRendering=true}else{if(c){this.setTemplate(c)}else{this.setTemplate(this.view.getTemplate(this.getDefaultFieldTemplateId()))}}},setup:function(){if(!this.initializing){this.data=this.getValue()}this.setDefaultTemplate();if(a.isUndefined(this.schema.required)){this.schema.required=false}if(a.isUndefined(this.options.validate)){this.options.validate=true}if(a.isUndefined(this.options.disabled)){this.options.disabled=false}if(a.isUndefined(this.options.showMessages)){this.options.showMessages=true}},bindData:function(){if(!a.isEmpty(this.data)){this.setValue(this.data)}},render:function(c,d){if(c&&(a.isString(c)||a.isObject(c))){this.view.setView(c)}else{if(a.isEmpty(d)&&a.isFunction(c)){d=c}}this.setup();this._render(d)},_render:function(e){var d=this;if(this.getEl()){this.getEl().remove()}if(this.options.renderForm){this.options.form.viewType=this.view.type;var c=this.form;if(!c){c=new a.Form(this.container,this.options.form,this.view.viewObject,this.connector,this.errorCallback)}c.render(function(f){d._processRender(f.formFieldsContainer,function(){d.getEl().appendTo(f.formFieldsContainer);f.topControl=d;if(d.view.type&&d.view.type!="view"){f.initEvents()}d.form=f;d.postRender();if(e&&a.isFunction(e)){e(d)}})})}else{this._processRender(this.container,function(){d.getEl().appendTo(d.container);d.postRender();if(e&&a.isFunction(e)){e(d)}})}},_processRender:function(d,e){var f=this;var c=this.getTemplate();this.connector.loadTemplate(c,function(h){var g=h;if(b(g)[0]&&b(g)[0].tagName.toLowerCase()=="script"&&b(g).attr("type")=="text/x-jquery-tmpl"){h=b(g).html()}f._renderLoadedTemplate(d,h,e)},function(g){f.errorCallback(g)})},_renderLoadedTemplate:function(c,e,f){var d=b.tmpl(e,{id:this.getId(),options:this.options,schema:this.schema,data:this.data,view:this.view.viewObject,path:this.path},{});d.appendTo(c);this.setEl(d);if(!this.singleLevelRendering){this.renderField(f)}else{if(f){f(this)}}},renderField:function(c){},postRender:function(){if(this.view.type!="view"){this.getEl().addClass("ui-widget alpaca-field");if(this.getEl().attr("id")==null){this.getEl().attr("id",this.getId()+"-field-outer")}if(this.getEl().attr("alpaca-field-id")==null){this.getEl().attr("alpaca-field-id",this.getId())}if(this.schema.required){this.getEl().addClass("alpaca-field-required")}else{this.getEl().addClass("alpaca-field-optional")}if(this.options.readonly){this.getEl().addClass("alpaca-field-readonly");b(":input",this.getEl()).attr("readonly","readonly");b("select",this.getEl()).attr("disabled","disabled");b(":radio",this.getEl()).attr("disabled","disabled");b(":checkbox",this.getEl()).attr("disabled","disabled")}if(this.options.hidden){this.getEl().hide()}var e=this.options.fieldClass;if(e){this.getEl().addClass(e)}var d=this.view.getStyles();if(d){for(var c in d){b(c,this.container).css(d[c])}}if(this.labelDiv&&this.schema.required){b('<span class="ui-icon ui-icon-star"></span>').prependTo(this.labelDiv)}if(this.options.disabled){this.disable()}if(this.view.type&&this.view.type=="edit"){this.bindData()}if(this.view.type&&this.view.type!="view"){this.initEvents()}}this.initializing=false;this.hideInitValidationError=a.isValEmpty(this.options.hideInitValidationError)?false:this.options.hideInitValidationError;if(this.view.type!="view"){this.renderValidationState()}this.hideInitValidationError=false;if(!this.view.displayReadonly){b(".alpaca-field-readonly",this.getEl()).hide()}if(this.options.postRender){this.options.postRender(this)}},getEl:function(){return this.outerEl},setEl:function(c){this.outerEl=c},getId:function(){return this.id},getParent:function(){return this.parent},isTopLevel:function(){return a.isEmpty(this.parent)},getValue:function(){return this.data},setValue:function(c){this.data=c},setDefault:function(){},getTemplate:function(){return this.template},setTemplate:function(c){if(a.isFunction(c)){c=c()}c=b.trim(c);this.template=c},displayMessage:function(d,c){var e=this;if(c==false){b("#[id^='"+e.getId()+"-field-message']",e.getEl()).remove()}if(d&&d.length>0){b.each(d,function(f,g){if(g.length>0){var h=e.view.getTemplate("controlFieldMessage");if(h){e.messageElement=b.tmpl(h,{message:g});if(e.hideInitValidationError){e.messageElement.addClass("ui-state-error-text alpaca-controlfield-message-hidden")}else{e.messageElement.addClass("ui-state-error-text alpaca-controlfield-message")}e.messageElement.attr("id",e.getId()+"-field-message-"+f);if(b(".alpaca-controlfield-message-container",e.getEl()).length){e.messageElement.appendTo(b(".alpaca-controlfield-message-container",e.getEl()))}else{e.messageElement.appendTo(e.getEl())}}}})}},renderValidationState:function(){if(this.options.validate){this.getEl().removeClass("alpaca-field-invalid ui-state-error alpaca-field-invalid-hidden");this.getEl().removeClass("alpaca-field-valid");var c=this.isValid();if(this.validate()){this.getEl().addClass("alpaca-field-valid")}else{if(!this.hideInitValidationError){this.getEl().addClass("ui-state-error alpaca-field-invalid")}else{this.getEl().addClass("alpaca-field-invalid-hidden")}}var g=this.isValid();if(this.options.showMessages&&!this.hideInitValidationError){if(!this.initializing){var f=[];for(var d in this.validation){if(!this.validation[d]["status"]){f.push(this.validation[d]["message"])}}this.displayMessage(f,c)}}var h=false;var e=this.parent;while(e){if(e.options&&e.options.forceRevalidation){h=true}e=e.parent}if((c!=g&&this.parent&&this.parent.renderValidationState)||h){this.parent.renderValidationState()}this._validateCustomValidator()}},showHiddenMessages:function(){b(".alpaca-field-invalid-hidden",this.outerEl).removeClass("alpaca-field-invalid-hidden").addClass("ui-state-error alpaca-field-invalid");b(".alpaca-controlfield-message-hidden",this.outerEl).removeClass("alpaca-controlfield-message-hidden").addClass("alpaca-controlfield-message")},updateValidationState:function(g,d){if(this.options.validate){var c=this.isValid();this.validation[g]=d;if(d&&!d.status){this.getEl().removeClass("alpaca-field-valid");this.getEl().addClass("ui-state-error alpaca-field-invalid")}this.validation[g]=d;if(this.options.showMessages){if(!this.initializing){var f=[];for(var e in this.validation){if(!this.validation[e]["status"]){f.push(this.validation[e]["message"])}}this.displayMessage(f,c)}}if(this.isValid()&&this.parent&&this.parent.renderValidationState){this.parent.renderValidationState()}}},validate:function(){var c=true;if(!this.initializing&&this.options.validate){c=this.handleValidate()}return c},handleValidate:function(){var d=this.validation;var c=this._validateOptional();d.notOptional={message:c?"":this.view.getMessage("notOptional"),status:c};c=this._validateDisallow();d.disallowValue={message:c?"":a.substituteTokens(this.view.getMessage("disallowValue"),[this.schema.disallow.join(",")]),status:c};return d.notOptional["status"]&&d.disallowValue["status"]},_validateCustomValidator:function(){var c=this;if(this.options.validator&&a.isFunction(this.options.validator)){this.options.validator(this,function(d){c.updateValidationState("customValidator",d)})}},_validateOptional:function(){if(this.schema.required&&this.isEmpty()){return false}return true},_validateDisallow:function(){if(!a.isValEmpty(this.schema.disallow)){var e=this.getValue();var d=this.schema.disallow;if(a.isArray(d)){var c=true;b.each(d,function(f,g){if((a.isObject(e)||a.isArray(e))&&a.isString(g)){g=b.parseJSON(g)}if(a.compareObject(e,g)){c=false}});return c}else{if((a.isObject(e)||a.isArray(e))&&a.isString(d)){d=b.parseJSON(d)}return !a.compareObject(e,d)}}return true},triggerUpdate:function(){this.getEl().trigger("fieldupdate")},disable:function(){},enable:function(){},focus:function(){},destroy:function(){this.getEl().remove()},show:function(){if(this.options&&this.options.hidden){return}else{this.getEl().css({display:""})}},hide:function(){this.getEl().css({display:"none"})},print:function(){if(this.container.printArea){this.container.printArea()}},reload:function(){this.initializing=true;if(this.callback!=null){this.callback(this,this.renderedCallback)}else{this.render(this.renderedCallback)}},clear:function(){var c=null;if(this.data){c=this.data}this.setValue(c)},isEmpty:function(){return a.isValEmpty(this.getValue())},isValid:function(c){if(b.isEmptyObject(this.validation)){return true}else{for(var e in this.validation){if(!this.validation[e].status){return false}}if(this.children&&c){for(var d=0;d<this.children.length;d++){var f=this.children[d];if(!f.isValid(c)){return false}}}return true}},initEvents:function(){var c=this;this.field.change(function(d){c.onChange(d)});this.field.focus(function(d){c.onFocus(d)});this.field.blur(function(d){c.onBlur(d)})},onFocus:function(c){this.getEl().removeClass("alpaca-field-empty");this.getEl().addClass("alpaca-field-focused")},onBlur:function(c){this.getEl().removeClass("alpaca-field-focused");this.renderValidationState()},onChange:function(c){this.data=this.getValue();this.triggerUpdate()},getControlByPath:function(f){var d=this;if(f){var e=f.split("/");for(var c=0;c<e.length;c++){if(!a.isValEmpty(e[c])){if(d&&d.childrenByPropertyId){if(d.childrenByPropertyId[e[c]]){d=d.childrenByPropertyId[e[c]]}else{return null}}else{return null}}else{return null}}return d}},getFieldType:function(){},getType:function(){},isContainer:function(){return false},getTitle:function(){},getDescription:function(){},getSchemaOfSchema:function(){var c={title:this.getTitle(),description:this.getDescription(),type:"object",properties:{title:{title:"Title",description:"Property short description",type:"string"},description:{title:"Description",description:"Property detailed description",type:"string"},readonly:{title:"Readonly",description:"Property will be read only if true",type:"boolean","default":false},required:{title:"Required",description:"Property value must be set if true",type:"boolean","default":false},"default":{title:"Default",description:"Property default value",type:"any"},type:{title:"Type",description:"Property data type",type:"string",readonly:true},format:{title:"Format",description:"Property data format",type:"string"},disallow:{title:"Disallow",description:"Disallowed values for the property",type:"array"},dependencies:{title:"Dependencies",description:"Property Dependencies",type:"array"}}};if(this.getType&&!a.isValEmpty(this.getType())){c.properties.type["default"]=this.getType();c.properties.type["enum"]=[this.getType()]}return c},getOptionsForSchema:function(){return{fields:{title:{helper:"Field short description",type:"text"},description:{helper:"Field detailed description",type:"textarea"},readonly:{helper:"Field will be read only if checked",rightLabel:"Is this field read only ?",type:"checkbox"},required:{helper:"Field value must be set if checked",rightLabel:"Is this field required ?",type:"checkbox"},"default":{helper:"Field default value",type:"textarea"},type:{helper:"Field data type",type:"text"},format:{type:"select",dataSource:function(d,e){for(var c in a.defaultFormatFieldMapping){d.selectOptions.push({value:c,text:c})}if(e){e()}}},disallow:{helper:"Disallowed values for the field",itemLabel:"Value",type:"array"},dependencies:{helper:"Field Dependencies",multiple:true,size:3,type:"select",dataSource:function(d,e){if(d.parent&&d.parent.schemaParent&&d.parent.schemaParent.parent){for(var c in d.parent.schemaParent.parent.childrenByPropertyId){if(c!=d.parent.schemaParent.propertyId){d.selectOptions.push({value:c,text:c})}}}if(e){e()}}}}}},getSchemaOfOptions:function(){var c={title:"Options for "+this.getTitle(),description:this.getDescription()+" (Options)",type:"object",properties:{renderForm:{},form:{},id:{title:"Field Id",description:"Unique field id. Auto-generated if not provided.",type:"string"},type:{title:"Field Type",description:"Field type",type:"string","default":this.getFieldType(),readonly:true},validate:{title:"Validation",description:"Field validation is required if true",type:"boolean","default":true},showMessages:{title:"Show Messages",description:"Display validation messages if true",type:"boolean","default":true},disabled:{title:"Disabled",description:"Field disabled if true",type:"boolean","default":false},readonly:{title:"Readonly",description:"Field will be read only if true",type:"boolean","default":false},hidden:{title:"Hidden",description:"Field will be read only if true",type:"boolean","default":false},label:{title:"Label",description:"Field label",type:"string"},helper:{title:"Helper",description:"Field help message",type:"string"},fieldClass:{title:"Style Class",description:"Additional field style class",type:"string"},hideInitValidationError:{title:"Hide Initial Validation Errors",description:"Hide initial validation errors.",type:"boolean"}}};if(this.isTopLevel()){c.properties.renderForm={title:"Render Form",description:"Render form tag as container for rest of fields.",type:"boolean","default":false};c.properties.form={title:"Form",description:"Options for form",type:"object",dependencies:"renderForm",properties:{attributes:{title:"Form Attributes",description:"Form attributes",type:"object",properties:{id:{title:"Id",description:"Unique form id. Auto-generated if not provided.",type:"string"},action:{title:"Action",description:"Form submission endpoint",type:"string"},method:{title:"Method",description:"Form submission method","enum":["post","get"],type:"string"},name:{title:"Name",description:"Form name",type:"string"}}},buttons:{title:"Button Options",description:"Button options",type:"object",properties:{submit:{title:"Submit Button",description:"Render submit button.",type:"boolean","default":true},reset:{title:"Reset Button",description:"Render reset button.",type:"boolean","default":true},save:{title:"Save Button",description:"Render save button.",type:"boolean"},reload:{title:"Reload Button",description:"Render reload button.",type:"boolean"},print:{title:"Print Button",description:"Render print button.",type:"boolean"},switchView:{title:"View Switch Button",description:"Render view switch button.",type:"boolean"}}}}}}else{delete c.properties.renderForm;delete c.properties.form}return c},getOptionsForOptions:function(){var c={type:"object",fields:{id:{type:"text",readonly:true},type:{type:"text"},validate:{rightLabel:"Is validation enforced ?",type:"checkbox"},showMessages:{rightLabel:"Show validation messages ?",type:"checkbox"},disabled:{rightLabel:"Disable this field ?",type:"checkbox"},label:{type:"text"},helper:{type:"textarea"},fieldClass:{type:"text"},hideInitValidationError:{rightLabel:"Hide initial validation errors ?",type:"checkbox"}}};if(this.isTopLevel()){c.fields.renderForm={type:"checkbox",rightLabel:"Yes"};c.fields.form={type:"object",dependencies:{renderForm:true},fields:{attributes:{type:"object",fields:{id:{type:"text",readonly:true},action:{type:"text"},method:{type:"select"},name:{type:"text"}}},buttons:{type:"object",fields:{submit:{rightLabel:"Yes",type:"checkbox"},reset:{rightLabel:"Yes",type:"checkbox"},save:{rightLabel:"Yes",type:"checkbox"},reload:{rightLabel:"Yes",type:"checkbox"},print:{rightLabel:"Yes",type:"checkbox"},viewSwitch:{rightLabel:"Yes",type:"checkbox"}}}}}}return c}});a.registerMessages({disallowValue:"{0} are disallowed values.",notOptional:"This field is not optional."})})(jQuery);(function(b){var a=b.alpaca;a.ControlField=a.Field.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setDefault:function(){var c=a.isEmpty(this.schema["default"])?"":this.schema["default"];this.setValue(c)},renderField:function(c){},injectField:function(e){var d=b(".alpaca-controlfield-container",this.outerEl);if(d.length){this.fieldContainer=d}else{this.fieldContainer=this.outerEl}var c=b(".alpaca-field-container-field",this.fieldContainer);if(c.length>0){if(c.attr("data-replace")=="true"){c.replaceWith(e)}else{e.appendTo(c)}}else{if(this.fieldContainer.attr("data-replace")=="true"){this.fieldContainer.replaceWith(e)}else{e.prependTo(this.fieldContainer)}}},postRender:function(){var d=b(".alpaca-controlfield-label",this.outerEl);if(d.length){this.labelDiv=d}var c=b(".alpaca-controlfield-helper",this.outerEl);if(c.length){this.helperDiv=c}this.base();this.outerEl.addClass("alpaca-controlfield")},_validateEnum:function(){if(this.schema["enum"]){var c=this.data;if(!this.schema.required&&a.isValEmpty(c)){return true}if(b.inArray(c,this.schema["enum"])>-1){return true}else{return false}}else{return true}},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateEnum();d.invalidValueOfEnum={message:c?"":a.substituteTokens(this.view.getMessage("invalidValueOfEnum"),[this.schema["enum"].join(",")]),status:c};return e&&d.invalidValueOfEnum["status"]},initEvents:function(){this.base();var c=this;this.field.keypress(function(d){c.onKeyPress(d)});this.field.keyup(function(d){c.onKeyUp(d)});this.field.click(function(d){c.onClick(d)})},onKeyPress:function(c){},onKeyUp:function(c){},onClick:function(c){},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{"enum":{title:"Enumeration",description:"List of property value options",type:"array"}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{"enum":{itemLabel:"Value",type:"array"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{name:{title:"Field name",description:"Field name",type:"string"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{name:{type:"text"}}})}});a.registerMessages({invalidValueOfEnum:"This field should have one of the values in {0}."})})(jQuery);(function(b){var a=b.alpaca;a.ContainerField=a.Field.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();var c=true;if(!a.isEmpty(this.view.collapsible)){c=this.view.collapsible}if(!a.isEmpty(this.options.collapsible)){c=this.options.collapsible}this.options.collapsible=c;var d="button";if(!a.isEmpty(this.view.legendStyle)){d=this.view.legendStyle}this.options.legendStyle=d;this.lazyLoading=false;if(!a.isEmpty(this.options.lazyLoading)){this.lazyLoading=this.options.lazyLoading}this.children=[];this.childrenById=[];this.childrenByPropertyId=[]},getDefaultFieldTemplateId:function(){return"fieldSet"},setDefaultTemplate:function(){this.base()},addChild:function(d,c){if(!a.isEmpty(c)){this.children.splice(c,0,d)}else{this.children.push(d)}this.childrenById[d.getId()]=d;if(d.propertyId){this.childrenByPropertyId[d.propertyId]=d}d.parent=this},initEvents:function(){var d=this;if(this.labelDiv){if(this.options.collapsible){this.labelDiv.addClass("legend-expanded");this.fieldSetDiv.addClass("fieldset-expanded");var c="ui-icon-circle-arrow-s";if(!a.isEmpty(this.options.collapsed)&&this.options.collapsed){c="ui-icon-circle-arrow-e";this.labelDiv.nextAll(".alpaca-fieldset-helper").slideToggle(500);this.labelDiv.nextAll(".alpaca-fieldset-items-container").slideToggle(500);this.labelDiv.nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500);this.fieldSetDiv.toggleClass("fieldset-expanded");this.fieldSetDiv.toggleClass("fieldset-collapsed");this.labelDiv.toggleClass("legend-expanded");this.labelDiv.toggleClass("legend-collapsed")}if(this.options.legendStyle=="link"){b('<span class="ui-icon '+c+'" style="float:left;margin-right:0.3em;"></span>').prependTo(this.labelDiv);this.labelDiv.click(function(){d.fieldSetDiv.toggleClass("fieldset-collapsed");d.fieldSetDiv.toggleClass("fieldset-expanded");b(this).toggleClass("legend-collapsed");b(this).toggleClass("legend-expanded");b(".ui-icon",this).toggleClass("ui-icon-circle-arrow-e").toggleClass("ui-icon-circle-arrow-s");b(this).nextAll(".alpaca-fieldset-helper").slideToggle(500);b(this).nextAll(".alpaca-fieldset-items-container").slideToggle(500);b(this).nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500)})}if(this.options.legendStyle=="button"){this.labelDiv.button({icons:{primary:c}}).click(function(){d.fieldSetDiv.toggleClass("fieldset-collapsed");d.fieldSetDiv.toggleClass("fieldset-expanded");b(this).toggleClass("legend-collapsed");b(this).toggleClass("legend-expanded");b(".ui-icon",this).toggleClass("ui-icon-circle-arrow-e").toggleClass("ui-icon-circle-arrow-s");b(this).nextAll(".alpaca-fieldset-helper").slideToggle(500);b(this).nextAll(".alpaca-fieldset-items-container").slideToggle(500);b(this).nextAll(".alpaca-fieldset-array-toolbar").slideToggle(500)})}}}},clear:function(c){a.each(this.children,function(){this.clear(false)});if(!c){this.triggerUpdate()}},setDefault:function(){if(a.isEmpty(this.schema["default"])){a.each(this.children,function(){this.setDefault()})}else{this.setValue(this.schema["default"])}},destroy:function(){a.each(this.children,function(){this.destroy()});this.base()},renderItemContainer:function(g,f,i){var e=this.view.getTemplate("fieldSetItemContainer");if(e){var c=b.tmpl(e,{});if(c.attr("data-replace")=="true"){return this.fieldContainer}else{if(g){b("#"+g+"-item-container",this.outerEl).after(c)}else{var d=this.fieldContainer;var j=this.view.getLayout().bindings;if(j){var h=j[i];if(h&&b("#"+h,d).length>0){d=b("#"+h,d)}}c.appendTo(d)}}return c}else{return this.fieldContainer}},renderField:function(f){var g=this;this.outerEl.addClass("ui-widget-content");var d=b(".alpaca-fieldset-legend",this.outerEl);if(d.length){this.labelDiv=d}var c=b(".alpaca-fieldset",this.outerEl);if(c.length){this.fieldSetDiv=c}else{this.fieldSetDiv=this.outerEl}var e=b(".alpaca-fieldset-items-container",this.outerEl);if(e.length){this.fieldContainer=e}else{this.fieldContainer=this.outerEl}if(!this.singleLevelRendering&&!this.lazyLoading){this.renderItems()}if(this.lazyLoading){if(this.labelDiv){b(this.labelDiv).click(function(){if(g.lazyLoading){g.renderItems();g.lazyLoading=false}})}}if(f){f()}},renderItems:function(c){},isContainer:function(){return true},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{collapsible:{title:"Collapsible",description:"Field set is collapsible if true",type:"boolean","default":true},collapsed:{title:"Collapsed",description:"Field set is initially collapsibled if true",type:"boolean","default":false},legendStyle:{title:"Legend Style",description:"Field set legend style",type:"string","enum":["button","link"],"default":"button"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{collapsible:{rightLabel:"Field set collapsible ?",helper:"Field set is collapsible if checked",type:"checkbox"},collapsed:{rightLabel:"Field set initially collapsed ?",description:"Field set is initially collapsed if checked",type:"checkbox"},legendStyle:{type:"select"}}})}})})(jQuery);(function(b){var a=b.alpaca;a.Form=Base.extend({constructor:function(e,g,d,c,f){var h=this;this.container=e;this.parent=null;this.connector=c;this.errorCallback=f;this.options=g;if(this.options.attributes){this.attributes=this.options.attributes}else{this.attributes={}}if(this.attributes.id){this.id=this.attributes.id}else{this.id=a.generateId();this.attributes.id=this.id}this.viewType=g.viewType;if(this.options.buttons){this.buttonOptions=this.options.buttons}else{this.buttonOptions={}}if(a.isEmpty(this.buttonOptions.submit)){this.buttonOptions.submit=true}if(a.isEmpty(this.buttonOptions.reset)){this.buttonOptions.reset=true}this.view=new a.View(d,this);this.buttons=[]},render:function(c){var d=this;this.template=this.view.getTemplate("form");if(this.outerEl){this.outerEl.remove()}this.processRender(this.container,function(){d.outerEl.appendTo(d.container);d.outerEl.addClass("alpaca-form");d.addButtons();if(c){c(d)}})},processRender:function(d,e){var f=this;var c=this.getTemplate();this.connector.loadTemplate(c,function(g){f._renderLoadedTemplate(d,g,e)},function(g){alert(g)});if(e){e()}},_renderLoadedTemplate:function(d,f,g){var c={id:this.getId(),options:this.options,view:this.view.viewObject};var e=b.tmpl(f,c,{});e.appendTo(d);this.outerEl=e;if(a.isEmpty(this.outerEl.attr("id"))){this.outerEl.attr("id",this.getId()+"-form-outer")}if(a.isEmpty(this.outerEl.attr("alpaca-field-id"))){this.outerEl.attr("alpaca-field-id",this.getId())}if(b(".alpaca-form-fields-container",this.outerEl)){this.formFieldsContainer=b(".alpaca-form-fields-container",this.outerEl)}else{this.formFieldsContainer=this.outerEl}this.field=b("form",this.container);if(this.field){this.field.attr(this.attributes)}},addButton:function(d){var f=this;if(d){var c=d.options?d.options:{};c.form=this;var e=d.postRender;c.type=c.type?c.type:"button";this.formButtonsContainer.alpaca({data:d.data,options:c,postRender:function(g){f.buttons.push(g);if(e&&a.isFunction(e)){e(g)}}})}},addButtons:function(){var c=this;if(b(".alpaca-form-buttons-container",this.outerEl)){this.formButtonsContainer=b(".alpaca-form-buttons-container",this.outerEl)}else{this.formButtonsContainer=this.outerEl}if(this.buttonOptions.print){this.addButton({options:{type:"printbutton"},postRender:function(d){c.printButton=d}})}if(this.buttonOptions.switchView){this.addButton({options:{type:"switchviewbutton"},postRender:function(d){c.switchViewButton=d}})}if(this.buttonOptions.reload&&this.viewType!="view"){this.addButton({options:{type:"reloadbutton"},postRender:function(d){c.reloadButton=d}})}if(this.buttonOptions.save&&this.viewType!="view"){this.addButton({options:{type:"savebutton"},postRender:function(d){c.saveButton=d}})}if(this.buttonOptions.submit&&this.viewType!="view"){this.addButton({options:{type:"button",buttonType:"submit"},data:"Submit",postRender:function(d){c.submitButton=d}})}if(this.buttonOptions.reset&&this.viewType!="view"){this.addButton({options:{type:"button",buttonType:"reset"},data:"Reset",postRender:function(d){c.resetButton=d}})}this.formButtonsContainer.addClass("ui-widget-header ui-corner-all")},getEl:function(){return this.outerEl},getId:function(){return this.id},getType:function(){return this.type},getParent:function(){return this.parent},getValue:function(){return this.topControl.getValue()},setValue:function(c){this.topControl.setValue(c)},initEvents:function(){var d=this;if(this.field){var c=this.getValue();b(this.field).submit(c,function(f){return d.onSubmit(f)})}},onSubmit:function(c){if(this.submitHandler){return this.submitHandler(c)}},registerSubmitHandler:function(c){if(a.isFunction(c)){this.submitHandler=c}},renderValidationState:function(){this.topControl.renderValidationState()},disable:function(){this.topControl.disable()},enable:function(){this.topControl.enable()},focus:function(){this.topControl.focus()},destroy:function(){this.getEl().remove()},show:function(){this.getEl().css({display:""})},hide:function(){this.getEl().css({display:"none"})},clear:function(c){this.topControl.clear(c)},isEmpty:function(){return this.topControl.isEmpty()},getTemplate:function(){return this.template},setTemplate:function(c){if(a.isFunction(c)){c=c()}c=b.trim(c);this.template=c}})})(jQuery);(function(b){var a=b.alpaca;a.Fields.AnyField=a.ControlField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();this.controlFieldTemplate=this.view.getTemplate("controlFieldAny")},renderField:function(c){if(this.controlFieldTemplate){this.field=b.tmpl(this.controlFieldTemplate,{id:this.getId(),options:this.options});this.injectField(this.field)}if(c){c()}},postRender:function(){this.base()},getValue:function(){return this.field.val()},setValue:function(c){if(a.isEmpty(c)){this.field.val("")}else{this.field.val(c)}this.base(c)},handleValidate:function(){var c=this.base();return c},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{}})},getTitle:function(){return"Any Field"},getDescription:function(){return"Any field."},getType:function(){return"any"},getFieldType:function(){return"any"}});a.registerTemplate("controlFieldAny",'<input type="text" id="${id}" size="40" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');a.registerFieldClass("any",a.Fields.AnyField);a.registerDefaultSchemaFieldMapping("any","any")})(jQuery);(function(b){var a=b.alpaca;a.Fields.TextField=a.ControlField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.size){this.options.size=40}this.controlFieldTemplate=this.view.getTemplate("controlFieldText")},renderField:function(c){if(this.controlFieldTemplate){this.field=b.tmpl(this.controlFieldTemplate,{id:this.getId(),options:this.options});this.injectField(this.field)}if(c){c()}},postRender:function(){this.base();if(this.field&&this.options.mask&&this.options.maskString){this.field.mask(this.options.maskString)}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-text")}},getValue:function(){return this.field.val()},setValue:function(c){if(a.isEmpty(c)){this.field.val("")}else{this.field.val(c)}this.base(c)},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validatePattern();d.invalidPattern={message:c?"":a.substituteTokens(this.view.getMessage("invalidPattern"),[this.schema.pattern]),status:c};c=this._validateMaxLength();d.stringTooLong={message:c?"":a.substituteTokens(this.view.getMessage("stringTooLong"),[this.schema.maxLength]),status:c};c=this._validateMinLength();d.stringTooShort={message:c?"":a.substituteTokens(this.view.getMessage("stringTooShort"),[this.schema.minLength]),status:c};return e&&d.invalidPattern["status"]&&d.stringTooLong["status"]&&d.stringTooShort["status"]},_validatePattern:function(){if(this.schema.pattern){var c=this.getValue();if(!a.isValEmpty(c)&&!c.match(this.schema.pattern)){return false}}return true},_validateMinLength:function(){if(!a.isEmpty(this.schema.minLength)){var c=this.getValue();if(!a.isEmpty(c)){if(c.length<this.schema.minLength){return false}}}return true},_validateMaxLength:function(){if(!a.isEmpty(this.schema.maxLength)){var c=this.getValue();if(!a.isEmpty(c)){if(c.length>this.schema.maxLength){return false}}}return true},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{minLength:{title:"Minimal Length",description:"Property value minimal length",type:"number"},maxLength:{title:"Maximum Length",description:"Property value maximum length",type:"number"},pattern:{title:"Pattern",description:"Property value pattern in regular expression",type:"string"}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{minLength:{type:"integer"},maxLength:{type:"integer"},pattern:{type:"text"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{size:{title:"Field Size",description:"Field size",type:"number","default":40},mask:{title:"Mask",description:"Enable field mask if true",type:"boolean"},maskString:{title:"Mask Expression",description:"Expression for field mask",type:"string"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{size:{type:"integer"},mask:{helper:"Enable field mask if checked",rightLabel:"Enable field mask?",type:"checkbox"},maskString:{helper:"a - an alpha character;9 - a numeric character;* - an alphanumeric character",type:"text"}}})},getTitle:function(){return"Single-Line Text"},getDescription:function(){return"Text field for single-line text."},getType:function(){return"string"},getFieldType:function(){return"text"}});a.registerTemplate("controlFieldText",'<input type="text" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');a.registerMessages({invalidPattern:"This field should have pattern {0}",stringTooShort:"This field should contain at least {0} numbers or characters",stringTooLong:"This field should contain at most {0} numbers or characters"});a.registerFieldClass("text",a.Fields.TextField);a.registerDefaultSchemaFieldMapping("string","text")})(jQuery);(function(b){var a=b.alpaca;a.Fields.NumberField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},getValue:function(){var c=this.field.val();if(a.isValEmpty(c)){return""}else{return parseFloat(c)}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-number")}},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateNumber();d.stringNotANumber={message:c?"":this.view.getMessage("stringNotANumber"),status:c};c=this._validateDivisibleBy();d.stringDivisibleBy={message:c?"":a.substituteTokens(this.view.getMessage("stringDivisibleBy"),[this.schema.divisibleBy]),status:c};c=this._validateMaximum();d.stringValueTooLarge={message:"",status:c};if(!c){if(this.schema.exclusiveMaximum){d.stringValueTooLarge["message"]=a.substituteTokens(this.view.getMessage("stringValueTooLargeExclusive"),[this.schema.maximum])}else{d.stringValueTooLarge["message"]=a.substituteTokens(this.view.getMessage("stringValueTooLarge"),[this.schema.maximum])}}c=this._validateMinimum();d.stringValueTooSmall={message:"",status:c};if(!c){if(this.schema.exclusiveMinimum){d.stringValueTooSmall["message"]=a.substituteTokens(this.view.getMessage("stringValueTooSmallExclusive"),[this.schema.minimum])}else{d.stringValueTooSmall["message"]=a.substituteTokens(this.view.getMessage("stringValueTooSmall"),[this.schema.minimum])}}return e&&d.stringNotANumber["status"]&&d.stringDivisibleBy["status"]&&d.stringValueTooLarge["status"]&&d.stringValueTooSmall["status"]},_validateNumber:function(){var c=this.field.val();if(a.isValEmpty(c)){return true}var d=this.getValue();if(isNaN(d)){return false}if(!c.match(a.regexps.number)){return false}return true},_validateDivisibleBy:function(){var c=this.getValue();if(!a.isEmpty(this.schema.divisibleBy)){if(!(c%this.schema.divisibleBy==0)){return false}}return true},_validateMaximum:function(){var c=this.getValue();if(!a.isEmpty(this.schema.maximum)){if(c>this.schema.maximum){return false}if(!a.isEmpty(this.schema.exclusiveMaximum)){if(c==this.schema.maximum&&this.schema.exclusiveMaximum){return false}}}return true},_validateMinimum:function(){var c=this.getValue();if(!a.isEmpty(this.schema.minimum)){if(c<this.schema.minimum){return false}if(!a.isEmpty(this.schema.exclusiveMinimum)){if(c==this.schema.minimum&&this.schema.exclusiveMinimum){return false}}}return true},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"number"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"number"},exclusiveMinimum:{title:"Exclusive Minimum",description:"Field value can not equal the number defined by the minimum attribute",type:"boolean","default":false},exclusiveMaximum:{title:"Exclusive Maximum",description:"Field value can not equal the number defined by the maxinum attribute",type:"boolean","default":false}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"number"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"number"},exclusiveMinimum:{rightLabel:"Exclusive minimum ?",helper:"Field value must be greater than but not equal to this number if checked",type:"checkbox"},exclusiveMaximum:{rightLabel:"Exclusive Maximum ?",helper:"Field value must be less than but not equal to this number if checked",type:"checkbox"}}})},getTitle:function(){return"Number Field"},getDescription:function(){return"Field for float numbers."},getType:function(){return"number"},getFieldType:function(){return"number"}});a.registerMessages({stringValueTooSmall:"The minimum value for this field is {0}",stringValueTooLarge:"The maximum value for this field is {0}",stringValueTooSmallExclusive:"Value of this field must be greater than {0}",stringValueTooLargeExclusive:"Value of this field must be less than {0}",stringDivisibleBy:"The value must be divisible by {0}",stringNotANumber:"This value is not a number."});a.registerFieldClass("number",a.Fields.NumberField);a.registerDefaultSchemaFieldMapping("number","number")})(jQuery);(function(b){var a=b.alpaca;a.Fields.IntegerField=a.Fields.NumberField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},getValue:function(){var c=this.field.val();if(a.isValEmpty(c)){return""}else{return parseInt(c)}},onChange:function(c){this.base();if(this.slider){this.slider.slider("value",this.getValue())}},postRender:function(){this.base();var c=this;if(this.options.slider){if(!a.isEmpty(this.schema.maximum)&&!a.isEmpty(this.schema.minimum)){this.field.after('<div id="slider"></div>');this.slider=b("#slider",this.field.parent()).slider({value:this.getValue(),min:this.schema.minimum,max:this.schema.maximum,slide:function(d,e){c.setValue(e.value);c.renderValidationState()}})}}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-integer")}},handleValidate:function(){var d=this.base();var c=this.validation;if(!c.stringNotANumber["status"]){c.stringNotANumber["message"]=this.view.getMessage("stringNotAnInteger")}return d},_validateNumber:function(){var c=this.field.val();if(a.isValEmpty(c)){return true}var d=this.getValue();if(isNaN(d)){return false}if(!c.match(a.regexps.integer)){return false}return true},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{minimum:{title:"Minimum",description:"Minimum value of the property",type:"integer"},maximum:{title:"Maximum",description:"Maximum value of the property",type:"integer"},divisibleBy:{title:"Divisible By",description:"Property value must be divisible by this number",type:"integer"}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{minimum:{helper:"Minimum value of the field",type:"integer"},maximum:{helper:"Maximum value of the field",type:"integer"},divisibleBy:{helper:"Property value must be divisible by this number",type:"integer"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{slider:{title:"Slider",description:"Generate slider control if true",type:"boolean","default":false}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{slider:{rightLabel:"Slider control ?",helper:"Generate slider control if selected",type:"checkbox"}}})},getTitle:function(){return"Integer Field"},getDescription:function(){return"Integer Field."},getType:function(){return"integer"},getFieldType:function(){return"integer"}});a.registerMessages({stringNotAnInteger:"This value is not an integer."});a.registerFieldClass("integer",a.Fields.IntegerField);a.registerDefaultSchemaFieldMapping("integer","integer")})(jQuery);(function(b){var a=b.alpaca;a.Fields.TextAreaField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.rows){this.options.rows=5}if(!this.options.cols){this.options.cols=40}this.controlFieldTemplate=this.view.getTemplate("controlFieldTextarea")},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-textarea")}},setValue:function(c){b(this.field).val(c);this.base(c)},getValue:function(){return b(this.field).val()},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{rows:{title:"Rows",description:"Number of rows",type:"number","default":5},cols:{title:"Columns",description:"Number of columns",type:"number","default":40}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{rows:{type:"integer"},cols:{type:"integer"}}})},getTitle:function(){return"Multi-Line Text"},getDescription:function(){return"Textare field for multiple line text."},getFieldType:function(){return"textarea"}});a.registerTemplate("controlFieldTextarea",'<textarea id="${id}" {{if options.rows}}rows="${options.rows}"{{/if}} {{if options.cols}}cols="${options.cols}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{each options.data}}data-${fieldId}="${value}"{{/each}}/>');a.registerFieldClass("textarea",a.Fields.TextAreaField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.WysiwygField=a.Fields.TextAreaField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();this.isWyswygLoaded=false},postRender:function(){this.base();var c=this.options.wysiwyg?this.options.wysiwyg:{};if(this.field.wysiwyg){if(this.options.onDemand&&!this.isWyswygLoaded){this.field.hover(function(){b(this).wysiwyg(c);this.isWyswygLoaded=true})}else{this.field.wysiwyg(c);this.isWyswygLoaded=true}}if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-wysiwyg")}},getTitle:function(){return"Wysiwyg Editor"},getDescription:function(){return"Wysiwyd editor for multi-line text."},getFieldType:function(){return"wysiwyg"}});a.registerFieldClass("wysiwyg",a.Fields.WysiwygField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.FileField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();this.controlFieldTemplate=this.view.getTemplate("controlFieldFile")},setValue:function(d){var c=this.field;this.field=b(".alpaca-filefield-control",this.fieldContainer);this.base(d);this.field=c},postRender:function(){if(this.field&&!a.isEmpty(this.options.styled)&&this.options.styled){this.field.customFileInput()}this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-file")}},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{styled:{title:"Custom Style",description:"Apply custom style if true.",type:"boolean","default":false}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{styled:{rightLabel:"Custom Style ?",helper:"Apply custom style if true.",type:"checkbox"}}})},getTitle:function(){return"File Field"},getDescription:function(){return"Field for uploading files."},getFieldType:function(){return"file"}});a.registerTemplate("controlFieldFile",'<input type="file" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');a.registerFieldClass("file",a.Fields.FileField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.CheckBoxField=a.ControlField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.rightLabel){this.options.rightLabel=""}},onClick:function(c){this.renderValidationState()},renderField:function(c){var d=this.view.getTemplate("controlFieldCheckbox");if(d){this.field=b.tmpl(d,{id:this.getId(),options:this.options});this.injectField(this.field);this.field=b('input[id="'+this.getId()+'"]',this.field)}if(c){c()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-checkbox")}},getValue:function(){return this.field.attr("checked")?true:false},setValue:function(c){if(a.isString(c)){c=c==="true"}if(a.isBoolean(c)){if(c){this.field.attr({checked:true})}else{this.field.attr({checked:false})}}this.base(c)},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{rightLabel:{title:"Option Label",description:"Option label",type:"string"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{rightLabel:{type:"text"}}})},getTitle:function(){return"Checkbox Field"},getDescription:function(){return"Checkbox Field."},getType:function(){return"boolean"},getFieldType:function(){return"checkbox"}});a.registerTemplate("controlFieldCheckbox",'<span><input type="checkbox" id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.name}}name="${options.name}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>{{if options.rightLabel}}<label for="${id}">${options.rightLabel}</label>{{/if}}</span>');a.registerFieldClass("checkbox",a.Fields.CheckBoxField);a.registerDefaultSchemaFieldMapping("boolean","checkbox")})(jQuery);(function(b){var a=b.alpaca;a.Fields.ListField=a.ControlField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){var c=this;c.base();c.selectOptions=[];if(c.getEnum()){b.each(c.getEnum(),function(d,e){var f=e;if(c.options.optionLabels&&c.options.optionLabels[d]){f=c.options.optionLabels[d]}c.selectOptions.push({value:e,text:f})})}},getEnum:function(){if(this.schema&&this.schema["enum"]){return this.schema["enum"]}},getValue:function(c){var d=this;if(a.isArray(c)){b.each(c,function(e,f){b.each(d.selectOptions,function(h,g){if(g.value==f){c[e]=g.value}})})}else{b.each(this.selectOptions,function(f,e){if(e.value==c){c=e.value}})}return c},renderField:function(e){var f=this;if(this.options.dataSource){if(a.isFunction(this.options.dataSource)){this.options.dataSource(this,function(){f._renderField(e)})}else{if(a.isUri(this.options.dataSource)){b.ajax({url:this.options.dataSource,type:"get",dataType:"json",success:function(h){var g=h;if(f.options.dsTransformer&&a.isFunction(f.options.dsTransformer)){g=f.options.dsTransformer(g)}if(g){if(a.isArray(g)){b.each(g,function(i,j){f.selectOptions.push({value:j,text:j})})}if(a.isObject(g)){b.each(g,function(i,j){f.selectOptions.push({value:i,text:j})})}}f._renderField(e)},error:function(g,i,h){f.errorCallback({message:"Unable to load data from uri : "+uri,stage:"DATASOURCE_LOADING_ERROR",details:{jqXHR:g,textStatus:i,errorThrown:h}})}})}else{var d=this.options.dataSource;if(f.options.dsTransformer&&a.isFunction(f.options.dsTransformer)){d=f.options.dsTransformer(d)}if(d){if(a.isArray(d)){b.each(d,function(g,h){f.selectOptions.push({value:h,text:h})})}if(a.isObject(d)){for(var c in d){f.selectOptions.push({value:c,text:d[c]})}}f._renderField(e)}}}}else{this._renderField(e)}},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{"enum":{title:"Enumeration",description:"List of field value options",type:"array",required:true}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{optionLabels:{title:"Option Labels",description:"Lables for options",type:"array"},dataSource:{title:"Option Datasource",description:"Datasource for generating options",type:"string"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{optionLabels:{itemLabel:"Label",type:"array"},dataSource:{type:"text"}}})}})})(jQuery);(function(b){var a=b.alpaca;a.Fields.SelectField=a.Fields.ListField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},getValue:function(){if(this.field){return this.base(this.field.val())}},setValue:function(c){if(a.isArray(c)){if(!a.compareArrayContent(c,this.getValue())){if(c!=null&&this.field){this.field.val(c)}this.base(c)}}else{if(c!=this.getValue()){if(c!=null&&this.field){this.field.val(c)}this.base(c)}}},_renderField:function(c){var d;if(this.options.multiple&&a.isArray(this.data)){d=this.view.getTemplate("controlFieldSelectMultiple")}else{d=this.view.getTemplate("controlFieldSelect")}if(d){this.field=b.tmpl(d,{id:this.getId(),options:this.options,required:this.schema.required,selectOptions:this.selectOptions,data:this.data});this.injectField(this.field)}if(c){c()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-select")}},onChange:function(c){this.base(c);var d=this;a.later(25,this,function(){var e=d.getValue();d.setValue(e);d.renderValidationState()})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{multiple:{title:"Mulitple Selection",description:"Allow multiple selection if true",type:"boolean","default":false},size:{title:"Displayed Options",description:"Number of options to be shown",type:"number"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{multiple:{rightLabel:"Allow mulitple selection ?",helper:"Allow multiple selection if checked",type:"checkbox"},size:{type:"integer"}}})},getTitle:function(){return"Dropdown Select"},getDescription:function(){return"Dropdown select field."},getFieldType:function(){return"select"}});a.registerTemplate("controlFieldSelect",'<select id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.multiple}}multiple{{/if}} {{if options.size}}size="${options.size}"{{/if}} {{if options.name}}name="${options.name}"{{/if}}>{{if !required}}<option value="">None</option>{{/if}}{{each(i,value) selectOptions}}<option value="${value}" {{if value == data}}selected="selected"{{/if}}>${text}</option>{{/each}}</select>');a.registerTemplate("controlFieldSelectMultiple",'<select id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.multiple}}multiple="multiple"{{/if}} {{if options.size}}size="${options.size}"{{/if}} {{if options.name}}name="${options.name}"{{/if}}>{{if !required}}<option value="">None</option>{{/if}}{{each(i,value) selectOptions}}<option value="${value}" {{each(j,val) data}}{{if value == val}}selected="selected"{{/if}}{{/each}}>${text}</option>{{/each}}</select>');a.registerFieldClass("select",a.Fields.SelectField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.RadioField=a.Fields.ListField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(this.options.name){this.name=this.options.name}else{this.name=this.getId()+"-name"}},getValue:function(){var c=this.base(b("input:radio[name="+this.name+"]:checked",this.field).val());b.each(this.selectOptions,function(){if(String(this["value"])==c){c=this["value"]}});return c},setValue:function(c){if(c!=this.getValue()){b.each(b("input:radio[name="+this.name+"]",this.field),function(){if(b(this).val()==c){b(this).attr("checked","checked")}else{b(this).removeAttr("checked")}});if(b("input:radio:checked",this.field).length==0){b("input:radio:first",this.field).attr("checked","checked")}this.base(c)}},_renderField:function(c){var d=this.view.getTemplate("controlFieldRadio");if(d){this.field=b.tmpl(d,{id:this.getId(),options:this.options,selectOptions:this.selectOptions,required:this.schema.required,name:this.name,data:this.data});if(b("input:radio:checked",this.field).length==0){b("input:radio:first",this.field).attr("checked","checked")}this.injectField(this.field)}if(c){c()}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-radio")}},onClick:function(c){this.base(c);var d=this;a.later(25,this,function(){var e=d.getValue();d.setValue(e);d.renderValidationState()})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{name:{title:"Field name",description:"Field name",type:"string",readonly:true}}})},getTitle:function(){return"Radio Group Field"},getDescription:function(){return"Radio Group Field."},getFieldType:function(){return"radio"}});a.registerTemplate("controlFieldRadio",'<div id="${id}" class="alpaca-controlfield-radio">{{if !required}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${name}" value=""/><span class="alpaca-controlfield-radio-label">None</span>{{/if}}{{each selectOptions}}<input type="radio" {{if options.readonly}}readonly="readonly"{{/if}} name="${name}" value="${value}" {{if value == data}}checked="checked"{{/if}}/><span class="alpaca-controlfield-radio-label">${text}</span>{{/each}}</div>');a.registerFieldClass("radio",a.Fields.RadioField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.ButtonField=a.ControlField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(this.options&&this.options.form){this.form=this.options.form;delete this.options.form}if(this.options&&this.options.buttonType){this.buttonType=this.options.buttonType}else{this.buttonType="button"}if(this.options&&this.options.label){this.label=this.options.label}this.buttonStyle=a.isEmpty(this.view.buttonStyle)?"button":this.view.buttonStyle},renderField:function(c){b(this.fieldContainer).addClass("alpaca-controlfield-button");var d=this.view.getTemplate("controlFieldButton");if(d){this.field=b.tmpl(d,{id:this.getId(),type:this.buttonType,value:this.data,label:this.label,options:this.options});this.field.addClass("alpaca-form-button");if(this.buttonStyle=="button"){this.button=this.field.button({text:true})}this.injectField(this.field)}if(c){c()}},getValue:function(){return b(this.field).val()},setValue:function(c){if(c){b(this.field).val(c)}else{b(this.field).val("")}this.base(c)},disable:function(){this.field.disabled=true},enable:function(){this.field.disabled=false},focus:function(){this.field.focus()},onClick:function(c){},getTitle:function(){return"Button Field"},getDescription:function(){return"Common Button Field."},getType:function(){return"any"}});a.registerTemplate("controlFieldButton",'<button type="${type}" id="${id}" {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{if value}}value="${value}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}>{{if label}}${label}{{else}}{{if value}}${value}{{/if}}{{/if}}</button>');a.registerFieldClass("button",a.Fields.ButtonField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.ObjectField=a.ContainerField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(a.isEmpty(this.data)){return}if(!a.isObject(this.data)){if(!a.isString(this.data)){return}else{try{this.data=b.parseJSON(this.data);if(!a.isObject(this.data)){return}}catch(c){return}}}},setValue:function(f){if(!f||!a.isObject(f)){return}for(var c in this.childrenById){var g=this.childrenById[c].propertyId;var e=a.traverseObject(f,g);if(!a.isEmpty(e)){var d=this.childrenById[c];d.setValue(e)}}},getValue:function(){var j={};for(var e=0;e<this.children.length;e++){var h=this.children[e].propertyId;var g=this.children[e].getValue();var f=this.childrenByPropertyId[h];var d=f.schema.dependencies;if(d){if(a.isString(d)){if(this.getDependencyStatus(h,d)){j[h]=g}}else{if(a.isArray(d)){var c=true;var k=this;b.each(d,function(i,l){c=c&&k.getDependencyStatus(h,l)});if(c){j[h]=g}}}}else{j[h]=g}}return j},postRender:function(){this.base();if(this.isTopLevel()){if(this.view){this.wizardConfigs=this.view.getWizard();var c=this.view.getLayout().template;if(this.wizardConfigs&&this.wizardConfigs.renderWizard){if(c){this.wizard()}else{this.autoWizard()}}}}},getIndex:function(e){if(a.isEmpty(e)){return -1}for(var d=0;d<this.children.length;d++){var c=this.children[d].propertyId;if(c==e){return d}}return -1},addItem:function(h,d,g,f){var i=this;var e;if(i.schema&&i.schema.properties&&i.schema.properties[h]){e=i.schema.properties[h]}var c=i.renderItemContainer(f,this,h);c.alpaca({data:g,options:d,schema:e,view:this.view.viewObject.id?this.view.viewObject.id:this.view.viewObject,connector:this.connector,notTopLevel:true,render:function(k){k.parent=i;k.propertyId=h;if(i.path!="/"){k.path=i.path+"/"+h}else{k.path=i.path+h}k.render();c.attr("id",k.getId()+"-item-container");c.attr("alpaca-id",k.getId());if(a.isEmpty(f)){i.addChild(k)}else{var j=i.getIndex(f);if(j!=-1){i.addChild(k,j+1)}else{i.addChild(k)}}if(f){i.renderValidationState()}}})},renderItems:function(){var i=this;var e=i.data;if(i.schema&&i.schema.properties){e=i.schema.properties}for(var h in e){var g={};if(i.options&&i.options.fields&&i.options.fields[h]){g=i.options.fields[h]}var d=null;if(i.data){d=i.data[h]}i.addItem(h,g,d)}for(var h in e){if(i.schema&&i.schema.properties&&i.schema.properties[h]){var f=i.schema.properties[h];var c=f.dependencies;if(c){if(a.isString(c)){this.enableDependency(h,c)}else{if(a.isArray(c)){b.each(c,function(j,k){i.enableDependency(h,k)})}}}}}this.renderValidationState()},getDependencyStatus:function(f,e){var d=this.childrenByPropertyId[e]&&!a.isValEmpty(this.childrenByPropertyId[e].data);var c=this.childrenByPropertyId[f].options.dependencies;if(c){if(c[e]!=null&&a.isFunction(c[e])){d=c[e].call(this,this.childrenByPropertyId[e].data)}else{if(d){if(a.isArray(c[e])){if(c[e]&&b.inArray(this.childrenByPropertyId[e].data,c[e])==-1){d=false}}else{if(c[e]!=null&&c[e]!=this.childrenByPropertyId[e].data){d=false}}}}}return d},renderDependency:function(f){var e=this.childrenByPropertyId[f];var d=e.schema.dependencies;if(d){if(a.isString(d)){if(this.getDependencyStatus(f,d)){e.show()}else{e.hide()}}else{if(a.isArray(d)){var c=true;var g=this;b.each(d,function(h,i){c=c&&g.getDependencyStatus(f,i)});if(c){e.show()}else{e.hide()}}}}},enableDependency:function(d,c){if(this.childrenByPropertyId[d]){this.renderDependency(d);var e=this;if(this.childrenByPropertyId[c]){this.childrenByPropertyId[c].getEl().bind("fieldupdate",function(f){e.renderDependency(d)})}}},wizard:function(){var f=this.outerEl;var d=b(".alpaca-wizard-step",f);var g=d.size();this.totalSteps=g;var h=this;var e=[];if(this.wizardConfigs.stepTitles){e=this.wizardConfigs.stepTitles}else{d.each(function(k){var j={title:"",description:""};if(b(".alpaca-wizard-step-title",this)){j.title=b(".alpaca-wizard-step-title",this).html();b(".alpaca-wizard-step-title",this).hide()}if(b(".alpaca-wizard-step-description",this)){j.description=b(".alpaca-wizard-step-description",this).html();b(".alpaca-wizard-step-description",this).hide()}e.push(j)})}var c=this._renderWizardStatusBar(e);if(c){b(f).before(c)}d.each(function(l){var p="step"+l;var m=h.view.getTemplate("wizardStep");if(m){var k=b.tmpl(m,{});k.attr("id",p);b(this).wrap(k)}var o=p+"-nav-bar";var j=h.view.getTemplate("wizardNavBar");if(j){var n=b.tmpl(j,{});n.attr("id",o);n.addClass("alpaca-wizard-nav-bar");b(this).append(n)}if(l==0){h._createNextButton(l);h._selectStep(l)}else{if(l==g-1){b("#step"+l).hide();h._createPrevButton(l)}else{b("#step"+l).hide();h._createPrevButton(l);h._createNextButton(l)}}b("#step"+l+"-nav-bar").buttonset()})},autoWizard:function(){var d=this.wizardConfigs.steps;if(!d){d=1}this.totalSteps=d;var f=this.wizardConfigs.bindings;if(!f){f={}}for(var k in this.childrenByPropertyId){if(!f.hasOwnProperty(k)){f[k]=1}}this.stepBindings=f;for(var j=0;j<d;j++){var g=j+1;var p=[];for(var k in f){if(f[k]==g){if(this.childrenByPropertyId&&this.childrenByPropertyId[k]){p.push("#"+this.childrenByPropertyId[k].container.attr("id"))}}}var h="step"+j;var m=this.view.getTemplate("wizardStep");if(m){var l=b.tmpl(m,{});l.attr("id",h);b(p.join(",")).wrapAll(l)}var n=h+"-nav-bar";var e=this.view.getTemplate("wizardNavBar");if(e){var c=b.tmpl(e,{});c.attr("id",n);c.addClass("alpaca-wizard-nav-bar");b("#"+h,this.outerEl).append(c)}}var o=this._renderWizardStatusBar(this.wizardConfigs.stepTitles);if(o){o.prependTo(this.fieldContainer)}for(var j=0;j<d;j++){if(j==0){this._createNextButton(j);this._selectStep(j)}else{if(j==d-1){b("#step"+j).hide();this._createPrevButton(j)}else{b("#step"+j).hide();this._createPrevButton(j);this._createNextButton(j)}}b("#step"+j+"-nav-bar").buttonset()}},_renderWizardStatusBar:function(d){var e=this.wizardConfigs.statusBar;if(e&&d){var f=this.view.getTemplate("wizardStatusBar");if(f){var c=b.tmpl(f,{id:this.getId()+"-wizard-status-bar",titles:d});c.addClass("alpaca-wizard-status-bar ui-widget-header ui-corner-all");return c}}},_createPrevButton:function(d){var g="step"+d;var f=this;var c=this.view.getTemplate("wizardPreButton");if(c){var e=b.tmpl(c,{});e.attr("id",g+"-button-pre");if(e.button){e.button({text:true,icons:{primary:"ui-icon-triangle-1-w"}})}e.click(function(){b("#"+g).hide();b("#step"+(d-1)).show();f._selectStep(d-1);return false});b("#"+g+"-nav-bar").append(e)}},_createNextButton:function(d){var g="step"+d;var f=this;var e=this.view.getTemplate("wizardNextButton");if(e){var c=b.tmpl(e,{});c.attr("id",g+"-button-next");if(c.button){c.button({text:true,icons:{secondary:"ui-icon-triangle-1-e"}})}c.click(function(){var h=true;if(f.view&&f.wizardConfigs&&f.wizardConfigs.validation){b.each(f.stepBindings,function(j,i){if(i==d+1&&h){h=f.childrenByPropertyId[j].validate()}})}if(h){b("#"+g).hide();b("#step"+(d+1)).show();f._selectStep(d+1)}return false});b("#"+g+"-nav-bar").append(c)}},_selectStep:function(c){b("#"+this.getId()+"-wizard-status-bar li").removeClass("current current-has-next ui-state-highlight ui-corner-all");b("#stepDesc"+c).addClass("current ui-state-highlight ui-corner-all");if(c<this.totalSteps-1){b("#stepDesc"+c).addClass("current-has-next")}},getSchemaOfSchema:function(){var e={properties:{properties:{title:"Field Properties",description:"List of Field Properties",type:"object"}}};var c=e.properties.properties;c.properties={};if(this.children){for(var d=0;d<this.children.length;d++){var f=this.children[d].propertyId;c.properties[f]=this.children[d].getSchemaOfSchema();c.properties[f].title=f+" :: "+c.properties[f].title}}return a.merge(this.base(),e)},getSchemaOfOptions:function(){var f=a.merge(this.base(),{properties:{}});var e={properties:{properties:{title:"Field Option Properties",description:"List of field option properties",type:"object"}}};var c=e.properties.properties;c.properties={};if(this.children){for(var d=0;d<this.children.length;d++){var g=this.children[d].propertyId;c.properties[g]=this.children[d].getSchemaOfOptions();c.properties[g].title=g+" :: "+c.properties[g].title}}return a.merge(f,e)},getTitle:function(){return"Composite Field"},getDescription:function(){return"Composite field for containing other fields"},getType:function(){return"object"},getFieldType:function(){return"object"}});a.registerFieldClass("object",a.Fields.ObjectField);a.registerDefaultSchemaFieldMapping("object","object")})(jQuery);(function(b){var a=b.alpaca;a.Fields.ArrayField=a.ContainerField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(a.isEmpty(this.data)){return}if(!a.isArray(this.data)){if(!a.isString(this.data)){return}else{try{this.data=b.parseJSON(this.data);if(!a.isArray(this.data)){return}}catch(c){this.data=[this.data]}}}this.options.toolbarStyle=a.isEmpty(this.view.toolbarStyle)?"button":this.view.toolbarStyle;if(this.schema.items&&this.schema.uniqueItems){a.mergeObject(this.options,{forceRevalidation:true})}},setValue:function(e){if(!e||!a.isArray(e)){return}for(var d=0;d<this.children.length;d++){var c=this.children[d];if(e.length<d){c.setValue(e[d])}}},getValue:function(){var e=[];for(var d=0;d<this.children.length;d++){var c=this.children[d].getValue();e.push(c)}return e},getSize:function(){return this.children.length},moveItem:function(c,d){var e=this;if(this.childrenById[c]){b.each(this.children,function(g,l){if(l.getId()==c){var j;if(d==true){j=g-1;if(j<0){j=e.children.length-1}}else{j=g+1;if(j>=e.children.length){j=0}}if(e.children[j]){var f=e.children[j].getId();var k=b("#"+c+"-item-container");var i=b("#"+f+"-item-container");e.reRenderItem(e.children[g],i);e.reRenderItem(e.children[j],k);var h=e.children[g];e.children[g]=e.children[j];e.children[j]=h;return false}}})}},removeItem:function(c){if(this._validateEqualMinItems()){this.children=b.grep(this.children,function(e,d){return(e.getId()!=c)});delete this.childrenById[c];b("#"+c+"-item-container",this.outerEl).remove();this.renderValidationState();this.updateToolbarItemsStatus()}},updateToolbarItemsStatus:function(){var c=this;if(c._validateEqualMaxItems()){b(".alpaca-fieldset-array-item-toolbar-add",this.outerEl).each(function(d){if(c.options.toolbarStyle=="button"&&b(this).button){b(this).button("enable")}else{b(this).removeClass("alpaca-fieldset-array-item-toolbar-disabled")}})}else{b(".alpaca-fieldset-array-item-toolbar-add",this.outerEl).each(function(d){if(c.options.toolbarStyle=="button"&&b(this).button){b(this).button("disable")}else{b(this).addClass("alpaca-fieldset-array-item-toolbar-disabled")}})}if(c._validateEqualMinItems()){b(".alpaca-fieldset-array-item-toolbar-remove",this.outerEl).each(function(d){if(c.options.toolbarStyle=="button"&&b(this).button){b(this).button("enable")}else{b(this).removeClass("alpaca-fieldset-array-item-toolbar-disabled")}})}else{b(".alpaca-fieldset-array-item-toolbar-remove",this.outerEl).each(function(d){if(c.options.toolbarStyle=="button"&&b(this).button){b(this).button("disable")}else{b(this).addClass("alpaca-fieldset-array-item-toolbar-disabled")}})}if(this.getSize()==0){this.renderArrayToolbar(this.outerEl)}else{if(this.arrayToolbar){this.arrayToolbar.remove()}}b(".alpaca-item-label-counter",this.outerEl).each(function(d){b(this).html(d+1)})},renderToolbar:function(f){var j=this;var d=f.attr("alpaca-id");var e=this.childrenById[d];var k=this.view.getTemplate("arrayItemToolbar");if(k){var g=b.tmpl(k,{id:d});if(g.attr("id")==null){g.attr("id",d+"-item-toolbar")}var l=b(".alpaca-fieldset-array-item-toolbar-add",g);if(l.button){l.button({text:false,icons:{primary:"ui-icon-circle-plus"}})}l.click(function(){var m=e.getValue();var n=j.addItem(f.index()+1,null,a.isValEmpty(m)?null:e.getValue(),d);j.enrichElements(n);return false});var i=b(".alpaca-fieldset-array-item-toolbar-remove",g);if(i.button){i.button({text:false,icons:{primary:"ui-icon-circle-minus"}})}i.click(function(){j.removeItem(d)});var h=b(".alpaca-fieldset-array-item-toolbar-up",g);if(h.button){h.button({text:false,icons:{primary:"ui-icon-circle-arrow-n"}})}h.click(function(){j.moveItem(d,true)});var c=b(".alpaca-fieldset-array-item-toolbar-down",g);if(c.button){c.button({text:false,icons:{primary:"ui-icon-circle-arrow-s"}})}c.click(function(){j.moveItem(d,false)});if(this.options.toolbarSticky){g.prependTo(f)}else{g.hide().prependTo(f);f.hover(function(){b(".alpaca-fieldset-array-item-toolbar",this).show()},function(){b(".alpaca-fieldset-array-item-toolbar",this).hide()})}}},renderArrayToolbar:function(c){var g=this;var f=c.attr("alpaca-id");var d=this.view.getTemplate("arrayToolbar");if(d){var e=b.tmpl(d,{id:f});if(e.attr("id")==null){e.attr("id",f+"-array-toolbar")}if(this.options.toolbarStyle=="link"){b(".alpaca-fieldset-array-toolbar-add",e).click(function(){var h=g.addItem(0,null,"",f);g.enrichElements(h)})}else{b(".alpaca-fieldset-array-toolbar-add",e).button({icons:{primary:"ui-icon-circle-plus"}}).click(function(){g.addItem(0,null,"",f);return false}).wrap("<small></small>")}e.appendTo(c);this.arrayToolbar=e}},reRenderItem:function(d,c){d.container=c;d.render();c.attr("id",d.getId()+"-item-container");c.attr("alpaca-id",d.getId());b(".alpaca-fieldset-array-item-toolbar",c).remove();this.renderToolbar(c);this.enrichElements(c)},addItem:function(d,e,h,g){var i=this;if(i._validateEqualMaxItems()){var f;if(i.schema&&i.schema.items){f=i.schema.items}if(e==null&&i.options&&i.options.fields&&i.options.fields.item){e=i.options.fields.item}var c=i.renderItemContainer(g);c.alpaca({data:h,options:e,schema:f,view:this.view.viewObject.id?this.view.viewObject.id:this.view.viewObject,connector:this.connector,notTopLevel:true,render:function(k){k.parent=i;k.path=i.path+"["+d+"]";k.render();c.attr("id",k.getId()+"-item-container");c.attr("alpaca-id",k.getId());if(i.options&&i.options.itemLabel){var l=i.view.getTemplate("itemLabel");var j=b.tmpl(l,{options:i.options,index:d?d+1:1,id:i.id});j.prependTo(c)}i.addChild(k,d);i.renderToolbar(c);i.renderValidationState()}});this.updateToolbarItemsStatus(this.outerEl);return c}},enrichElements:function(c){if(c){if(c.find('[data-role="fieldcontain"]').fieldcontain){c.find('[data-role="fieldcontain"]').fieldcontain();c.find('[data-role="fieldcontain"]').find("[type='radio'], [type='checkbox']").checkboxradio();c.find('[data-role="fieldcontain"]').find("button, [data-role='button'], [type='button'], [type='submit'], [type='reset'], [type='image']").not(".ui-nojs").button();c.find('[data-role="fieldcontain"]').find("input, textarea").not("[type='radio'], [type='checkbox'], button, [type='button'], [type='submit'], [type='reset'], [type='image']").textinput();c.find('[data-role="fieldcontain"]').find("input, select").filter("[data-role='slider'], [data-type='range']").slider();c.find('[data-role="fieldcontain"]').find("select:not([data-role='slider'])").selectmenu();c.find('[data-role="button"]').buttonMarkup()}}},renderItems:function(){var c=this;if(this.data){b.each(this.data,function(d,f){var e;if(c.options&&c.options.fields&&c.options.fields.item){e=c.options.fields.item}c.addItem(d,e,f)})}this.updateToolbarItemsStatus()},_validateEqualMaxItems:function(){if(this.schema.items&&this.schema.items.maxItems){if(this.getSize()>=this.schema.items.maxItems){return false}}return true},_validateEqualMinItems:function(){if(this.schema.items&&this.schema.items.minItems){if(this.getSize()<=this.schema.items.minItems){return false}}return true},_validateMinItems:function(){if(this.schema.items&&this.schema.items.minItems){if(this.getSize()<this.schema.items.minItems){return false}}return true},_validateMaxItems:function(){if(this.schema.items&&this.schema.items.maxItems){if(this.getSize()>this.schema.items.maxItems){return false}}return true},_validateUniqueItems:function(){if(this.schema.items&&this.schema.uniqueItems){var e={};for(var d=0,c=this.children.length;d<c;++d){if(!e.hasOwnProperty(this.children[d])){e[this.children[d]]=true}else{return false}}}return true},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateUniqueItems();d.valueNotUnique={message:c?"":this.view.getMessage("valueNotUnique"),status:c};c=this._validateMaxItems();d.tooManyItems={message:c?"":a.substituteTokens(this.view.getMessage("tooManyItems"),[this.schema.items.maxItems]),status:c};c=this._validateMinItems();d.notEnoughItems={message:c?"":a.substituteTokens(this.view.getMessage("notEnoughItems"),[this.schema.items.minItems]),status:c};return e&&d.valueNotUnique["status"]&&d.tooManyItems["status"]&&d.notEnoughItems["status"]},getSchemaOfSchema:function(){var c={properties:{items:{title:"Array Items",description:"Schema of array items",type:"object",properties:{minItems:{title:"Minimum Items",description:"Minimum number of items",type:"number"},maxItems:{title:"Maximum Items",description:"Maximum number of items",type:"number"},uniqueItems:{title:"Items Unique",description:"Item values should be unique if true",type:"boolean","default":false}}}}};if(this.children&&this.children[0]){a.merge(c.properties.items.properties,this.children[0].getSchemaOfSchema())}return a.merge(this.base(),c)},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{items:{type:"object",fields:{minItems:{type:"integer"},maxItems:{type:"integer"},uniqueItems:{type:"checkbox"}}}}})},getSchemaOfOptions:function(){var c={properties:{items:{title:"Array Items",description:"Schema of array items",type:"object",properties:{toolbarSticky:{title:"Sticky Toolbar",description:"Toolbar will be aways on if true",type:"boolean","default":false}}}}};if(this.children&&this.children[0]){a.merge(c.properties.items.properties,this.children[0].getSchemaOfSchema())}return a.merge(this.base(),c)},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{items:{type:"object",fields:{toolbarSticky:{type:"checkbox"}}}}})},getTitle:function(){return"Array Field"},getDescription:function(){return"Array Field."},getType:function(){return"array"},getFieldType:function(){return"array"}});a.registerTemplate("itemLabel",'{{if options.itemLabel}}<div class="alpaca-controlfield-label"><div>${options.itemLabel}{{if index}} <span class="alpaca-item-label-counter">${index}</span>{{/if}}</div></div>{{/if}}');a.registerTemplate("arrayToolbar",'<span class="ui-widget ui-corner-all alpaca-fieldset-array-toolbar"><button class="alpaca-fieldset-array-toolbar-icon alpaca-fieldset-array-toolbar-add">Add Item</button></span>');a.registerTemplate("arrayItemToolbar",'<div class="ui-widget-header ui-corner-all alpaca-fieldset-array-item-toolbar"><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-add">Add Item</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-remove">Remove Item</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-up">Move Up</button><button class="alpaca-fieldset-array-item-toolbar-icon alpaca-fieldset-array-item-toolbar-down">Move Down</button></div>');a.registerMessages({notEnoughItems:"The minimum number of items is {0}",tooManyItems:"The maximum number of items is {0}",valueNotUnique:"Values are not unique",notAnArray:"This value is not an Array"});a.registerFieldClass("array",a.Fields.ArrayField);a.registerDefaultSchemaFieldMapping("array","array")})(jQuery);(function(b){var a=b.alpaca;a.Fields.UpperCaseField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-uppercase")}},setValue:function(c){var d=c.toUpperCase();if(d!=this.getValue()){this.base(d)}},onKeyPress:function(c){this.base(c);var d=this;a.later(25,this,function(){var e=d.getValue();d.setValue(e)})},getTitle:function(){return"Uppercase Text"},getDescription:function(){return"Text Field for uppercase text."},getFieldType:function(){return"uppercase"}});a.registerFieldClass("uppercase",a.Fields.UpperCaseField);a.registerDefaultFormatFieldMapping("uppercase","uppercase")})(jQuery);(function(b){var a=b.alpaca;a.Fields.LowerCaseField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-lowercase")}},setValue:function(d){var c=d.toLowerCase();if(c!=this.getValue()){this.base(c)}},onKeyPress:function(c){this.base(c);var d=this;a.later(25,this,function(){var e=d.getValue();d.setValue(e)})},getTitle:function(){return"Lowercase Text"},getDescription:function(){return"Text Field for lowercase text."},getFieldType:function(){return"lowercase"}});a.registerFieldClass("lowercase",a.Fields.LowerCaseField);a.registerDefaultFormatFieldMapping("lowercase","lowercase")})(jQuery);(function(b){var a=b.alpaca;a.Fields.PersonalNameField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-personalname")}},setValue:function(d){var e="";for(var c=0;c<d.length;c++){if(c==0){e+=d.charAt(c).toUpperCase()}else{if(d.charAt(c-1)==" "||d.charAt(c-1)=="-"||d.charAt(c-1)=="'"){e+=d.charAt(c).toUpperCase()}else{e+=d.charAt(c)}}}if(e!=this.getValue()){this.base(e)}},onKeyPress:function(c){this.base(c);var d=this;a.later(25,this,function(){var e=d.getValue();d.setValue(e)})},getTitle:function(){return"Personal Name"},getDescription:function(){return"Text Field for personal name with captical letter for first letter & after hyphen, space or apostrophe."},getFieldType:function(){return"personalname"}});a.registerFieldClass("personalname",a.Fields.PersonalNameField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.IPv4Field=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=a.regexps.ipv4}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-ipv4")}},handleValidate:function(){var d=this.base();var c=this.validation;if(!c.invalidPattern["status"]){c.invalidPattern["message"]=this.view.getMessage("invalidIPv4")}return d},getSchemaOfSchema:function(){var c=(this.schema&&this.schema.pattern)?this.schema.pattern:a.regexps.ipv4;return a.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":c,readonly:true},format:{title:"Format",description:"Property data format",type:"string","enum":["ip-address"],"default":"ip-address",readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"IP Address Field"},getDescription:function(){return"IP Address Field."},getFieldType:function(){return"ipv4"}});a.registerMessages({invalidIPv4:"Invalid IPv4 address, e.g. 192.168.0.1"});a.registerFieldClass("ipv4",a.Fields.IPv4Field);a.registerDefaultFormatFieldMapping("ip-address","ipv4")})(jQuery);(function(b){var a=b.alpaca;a.Fields.DateField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.dateFormat){this.options.dateFormat=a.defaultDateFormat}if(!this.options.dateFormatRegex){this.options.dateFormatRegex=a.regexps.date}},postRender:function(){this.base();if(this.field.datepicker){this.field.datepicker({dateFormat:this.options.dateFormat});if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-date")}}},onChange:function(c){this.base();this.renderValidationState()},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateDateFormat();d.invalidDate={message:c?"":a.substituteTokens(this.view.getMessage("invalidDate"),[this.options.dateFormat]),status:c};return e&&d.invalidDate["status"]},_validateDateFormat:function(){var c=this.field.val();if(b.datepicker){try{b.datepicker.parseDate(this.options.dateFormat,c);return true}catch(d){return false}}else{return c.match(this.options.dateFormatRegex)}},setValue:function(c){if(c==""){this.base(c);return}this.base(c)},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{format:{title:"Format",description:"Property data format",type:"string","default":"date","enum":["date"],readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{dateFormat:{title:"Date Format",description:"Date format",type:"string","default":a.defaultDateFormat},dateFormatRegex:{title:"Format Regular Expression",description:"Regular expression for validation date format",type:"string","default":a.regexps.date}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{dateFormat:{type:"text"},dateFormatRegex:{type:"text"}}})},getTitle:function(){return"Date Field"},getDescription:function(){return"Date Field."},getFieldType:function(){return"date"}});a.registerMessages({invalidDate:"Invalid date for format {0}"});a.registerFieldClass("date",a.Fields.DateField);a.registerDefaultFormatFieldMapping("date","date")})(jQuery);(function(b){var a=b.alpaca;a.Fields.PasswordField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=a.regexps.password}this.controlFieldTemplate=this.view.getTemplate("controlFieldPassword")},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-password")}},handleValidate:function(){var d=this.base();var c=this.validation;if(!c.invalidPattern["status"]){c.invalidPattern["message"]=this.view.getMessage("invalidPassword")}return d},getSchemaOfSchema:function(){var c=(this.schema&&this.schema.pattern)?this.schema.pattern:/^[0-9a-zA-Z\x20-\x7E]*$/;return a.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":this.schema.pattern,"enum":[c],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"password","enum":["password"],readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"Password Field"},getDescription:function(){return"Password Field."},getFieldType:function(){return"password"}});a.registerTemplate("controlFieldPassword",'<input type="password" id="${id}" {{if options.size}}size="${options.size}"{{/if}} {{if options.readonly}}readonly="readonly"{{/if}} {{if options.formName}}name="${options.formName}"{{/if}} {{each(i,v) options.data}}data-${i}="${v}"{{/each}}/>');a.registerMessages({invalidPassword:"Invalid Password"});a.registerFieldClass("password",a.Fields.PasswordField);a.registerDefaultFormatFieldMapping("password","password")})(jQuery);(function(b){var a=b.alpaca;a.Fields.EmailField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=a.regexps.email}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-email")}},handleValidate:function(){var d=this.base();var c=this.validation;if(!c.invalidPattern["status"]){c.invalidPattern["message"]=this.view.getMessage("invalidEmail")}return d},getSchemaOfSchema:function(){var c=(this.schema&&this.schema.pattern)?this.schema.pattern:a.regexps.email;return a.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":c,"enum":[c],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"email","enum":["email"],readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getTitle:function(){return"Email Field"},getDescription:function(){return"Email Field."},getFieldType:function(){return"email"}});a.registerMessages({invalidEmail:"Invalid Email address e.g. admin@gitanasoftware.com"});a.registerFieldClass("email",a.Fields.EmailField);a.registerDefaultFormatFieldMapping("email","email")})(jQuery);(function(b){var a=b.alpaca;a.Fields.PhoneField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.schema.pattern){this.schema.pattern=a.regexps.phone}if(a.isEmpty(this.options.mask)){this.options.mask=true}if(a.isEmpty(this.options.maskString)){this.options.maskString="(999) 999-9999"}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-phone")}},handleValidate:function(){var d=this.base();var c=this.validation;if(!c.invalidPattern["status"]){c.invalidPattern["message"]=this.view.getMessage("invalidPhone")}return d},getSchemaOfSchema:function(){var c=(this.schema&&this.schema.pattern)?this.schema.pattern:a.regexps.phone;return a.merge(this.base(),{properties:{pattern:{title:"Pattern",description:"Field Pattern in Regular Expression",type:"string","default":c,"enum":[c],readonly:true},format:{title:"Format",description:"Property data format",type:"string","default":"phone","enum":["phone"],readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{mask:{title:"Field Mask Option",description:"Enable field mask if true",type:"boolean","default":true},maskString:{title:"Field Mask String",description:"Expression for field mask",type:"string","default":"(999) 999-9999"}}})},getTitle:function(){return"Phone Field"},getDescription:function(){return"Phone Field."},getFieldType:function(){return"phone"}});a.registerMessages({invalidPhone:"Invalid Phone Number, e.g. (123) 456-9999"});a.registerFieldClass("phone",a.Fields.PhoneField);a.registerDefaultFormatFieldMapping("phone","phone")})(jQuery);(function(b){var a=b.alpaca;a.Fields.JSONField=a.Fields.TextAreaField.extend({constructor:function(f,j,h,i,e,d,g){this.base(f,j,h,i,e,d,g)},setValue:function(d){if(a.isObject(d)){d=JSON.stringify(d,null," ")}this.base(d)},getValue:function(){var d=this.base();if(d&&a.isString(d)){d=JSON.parse(d)}return d},handleValidate:function(){var f=this.base();var e=this.validation;var d=this._validateJSON();e.stringNotAJSON={message:d.status?"":this.view.getMessage("stringNotAJSON")+" "+d.message,status:d.status};return f&&e.stringNotAJSON["status"]},_validateJSON:function(){var d=this.field.val();if(a.isValEmpty(d)){return{status:true}}try{var g=JSON.parse(d);this.setValue(JSON.stringify(g,null," "));return{status:true}}catch(f){return{status:false,message:f.message}}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-json")}var d=this;this.field.bind("keypress",function(f){if(f.which==34){d.field.insertAtCaret('"')}if(f.which==123){d.field.insertAtCaret("}")}if(f.which==91){d.field.insertAtCaret("]")}});this.field.bind("keypress","Ctrl+l",function(){d.getEl().removeClass("alpaca-field-focused");d.renderValidationState()});this.field.attr("title","Type Ctrl+L to format and validate the JSON string.")},getTitle:function(){return"JSON Editor"},getDescription:function(){return"Editor for JSON objects with basic validation and formatting."},getFieldType:function(){return"json"}});a.registerMessages({stringNotAJSON:"This value is not a valid JSON string."});a.registerFieldClass("json",a.Fields.JSONField);b.fn.insertAtCaret=function(d){return this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=d;this.focus()}else{if(this.selectionStart||this.selectionStart=="0"){var f=this.selectionStart;var e=this.selectionEnd;var g=this.scrollTop;this.value=this.value.substring(0,f)+d+this.value.substring(e,this.value.length);this.focus();this.selectionStart=f;this.selectionEnd=f;this.scrollTop=g}else{this.value+=d;this.focus()}}})};jQuery.hotkeys={version:"0.8",specialKeys:{8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},shiftNums:{"`":"~","1":"!","2":"@","3":"#","4":"$","5":"%","6":"^","7":"&","8":"*","9":"(","0":")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"}};function c(e){if(typeof e.data!=="string"){return}var d=e.handler,f=e.data.toLowerCase().split(" ");e.handler=function(o){if(this!==o.target&&(/textarea|select/i.test(o.target.nodeName)||o.target.type==="text")){return}var j=o.type!=="keypress"&&jQuery.hotkeys.specialKeys[o.which],p=String.fromCharCode(o.which).toLowerCase(),m,n="",h={};if(o.altKey&&j!=="alt"){n+="alt+"}if(o.ctrlKey&&j!=="ctrl"){n+="ctrl+"}if(o.metaKey&&!o.ctrlKey&&j!=="meta"){n+="meta+"}if(o.shiftKey&&j!=="shift"){n+="shift+"}if(j){h[n+j]=true}else{h[n+p]=true;h[n+jQuery.hotkeys.shiftNums[p]]=true;if(n==="shift+"){h[jQuery.hotkeys.shiftNums[p]]=true}}for(var k=0,g=f.length;k<g;k++){if(h[f[k]]){return d.apply(this,arguments)}}}}jQuery.each(["keydown","keyup","keypress"],function(){jQuery.event.special[this]={add:c}})})(jQuery);(function(b){var a=b.alpaca;a.Fields.MapField=a.Fields.ArrayField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){if(a.isEmpty(this.data)){return}if(!a.isArray(this.data)){if(a.isObject(this.data)){var c=[];b.each(this.data,function(d,e){var f=a.cloneObject(e);f._key=d;c.push(f)});this.data=c}}a.mergeObject(this.options,{forceRevalidation:true});this.base()},getValue:function(){var f={};for(var e=0;e<this.children.length;e++){var c=this.children[e].getValue();var d=c._key;if(d){delete c._key;f[d]=c}}return f},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateKey();d.keyNotUnique={message:c.status?"":this.view.getMessage("keyNotUnique"),status:c.status};return e&&d.keyNotUnique["status"]},_validateKey:function(){var c=0;b.each(this.getValue(),function(){c++});if(c!=this.children.length){return{status:false}}else{return{status:true}}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-map")}},getTitle:function(){return"Map Field"},getDescription:function(){return"Field for objects with key/value pairs that share the same schema for values."},getFieldType:function(){return"map"}});a.registerFieldClass("map",a.Fields.MapField);a.registerMessages({keyNotUnique:"Keys of map field are not unique."})})(jQuery);(function(b){var a=b.alpaca;a.Fields.TagField=a.Fields.LowerCaseField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.separator){this.options.separator=","}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-tag")}},getValue:function(){var c=this.base();if(c==""){return[]}return c.split(this.options.separator)},setValue:function(c){if(c==""){return}this.base(c.join(this.options.separator))},onBlur:function(f){this.base(f);var c=this.getValue();var d=[];b.each(c,function(g,e){if(e.trim()!=""){d.push(e.trim())}});this.setValue(d)},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{separator:{title:"Separator",description:"Separator used to split tags.",type:"string","default":","}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{separator:{type:"text"}}})},getTitle:function(){return"Tag Field"},getDescription:function(){return"Text field for entering list of tags separated by delimiter."},getFieldType:function(){return"tag"}});a.registerFieldClass("tag",a.Fields.TagField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.TimeField=a.Fields.TextField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.options.timeFormat){this.options.timeFormat="hh:mm:ss"}if(!this.options.timeFormatRegex){this.options.timeFormatRegex=/^(([0-1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9])$/}if(a.isEmpty(this.options.mask)){this.options.mask=true}if(a.isEmpty(this.options.maskString)){this.options.maskString="99:99:99"}},postRender:function(){this.base();if(this.fieldContainer){this.fieldContainer.addClass("alpaca-controlfield-time")}},onChange:function(c){this.base();this.renderValidationState()},handleValidate:function(){var e=this.base();var d=this.validation;var c=this._validateTimeFormat();d.invalidTime={message:c?"":a.substituteTokens(this.view.getMessage("invalidTime"),[this.options.timeFormat]),status:c};return e&&d.invalidTime["status"]},_validateTimeFormat:function(){var c=this.field.val();if(!this.schema.required&&(a.isValEmpty(c)||c=="__:__:__")){return true}return c.match(this.options.timeFormatRegex)},setValue:function(c){if(c==""){this.base(c);return}this.base(c)},getSchemaOfSchema:function(){return a.merge(this.base(),{properties:{format:{title:"Format",description:"Property data format",type:"string","default":"time","enum":["time"],readonly:true}}})},getOptionsForSchema:function(){return a.merge(this.base(),{fields:{format:{type:"text"}}})},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{timeFormat:{title:"Time Format",description:"Time format",type:"string","default":"hh:mm:ss"},timeFormatRegex:{title:"Format Regular Expression",description:"Regular expression for validation time format",type:"string","default":/^(([0-1][0-9])|([2][0-3])):([0-5][0-9]):([0-5][0-9])$/},mask:{"default":true},maskString:{"default":"99:99:99"}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{timeFormat:{type:"text"},timeFormatRegex:{type:"text"}}})},getTitle:function(){return"Time Field"},getDescription:function(){return"Field for time."},getFieldType:function(){return"time"}});a.registerMessages({invalidTime:"Invalid time for format {0}"});a.registerFieldClass("time",a.Fields.TimeField);a.registerDefaultFormatFieldMapping("time","time")})(jQuery);(function(b){var a=b.alpaca;a.Fields.AddressField=a.Fields.ObjectField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();this.schema={title:"Home Address",type:"object",properties:{street:{title:"Street",type:"array",items:{type:"string",maxLength:30,minItems:0,maxItems:3}},city:{title:"City",type:"string"},state:{title:"State",type:"string","enum":["AL","AK","AS","AZ","AR","CA","CO","CT","DE","DC","FM","FL","GA","GU","HI","ID","IL","IN","IA","KS","KY","LA","ME","MH","MD","MA","MI","MN","MS","MO","MT","NE","NV","NH","NJ","NM","NY","NC","ND","MP","OH","OK","OR","PW","PA","PR","RI","SC","SD","TN","TX","UT","VT","VI","VA","WA","WV","WI","WY"]},zip:{title:"Zip Code",type:"string",pattern:/^(\d{5}(-\d{4})?)?$/}}};a.merge(this.options,{fields:{zip:{mask:true,maskString:"99999",size:5},state:{optionLabels:["ALABAMA","ALASKA","AMERICANSAMOA","ARIZONA","ARKANSAS","CALIFORNIA","COLORADO","CONNECTICUT","DELAWARE","DISTRICTOFCOLUMBIA","FEDERATEDSTATESOFMICRONESIA","FLORIDA","GEORGIA","GUAM","HAWAII","IDAHO","ILLINOIS","INDIANA","IOWA","KANSAS","KENTUCKY","LOUISIANA","MAINE","MARSHALLISLANDS","MARYLAND","MASSACHUSETTS","MICHIGAN","MINNESOTA","MISSISSIPPI","MISSOURI","MONTANA","NEBRASKA","NEVADA","NEWHAMPSHIRE","NEWJERSEY","NEWMEXICO","NEWYORK","NORTHCAROLINA","NORTHDAKOTA","NORTHERNMARIANAISLANDS","OHIO","OKLAHOMA","OREGON","PALAU","PENNSYLVANIA","PUERTORICO","RHODEISLAND","SOUTHCAROLINA","SOUTHDAKOTA","TENNESSEE","TEXAS","UTAH","VERMONT","VIRGINISLANDS","VIRGINIA","WASHINGTON","WESTVIRGINIA","WISCONSIN","WYOMING"]}}});if(a.isEmpty(this.options.addressValidation)){this.options.addressValidation=true}},getAddress:function(){var d=this.getValue();if(this.view.type=="view"){d=this.data}var c="";if(d){if(d.street){b.each(d.street,function(e,f){c+=f+" "})}if(d.city){c+=d.city+" "}if(d.state){c+=d.state+" "}if(d.zip){c+=d.zip}}return c},renderField:function(c){this.base();var d=this;b(this.fieldContainer).addClass("alpaca-addressfield");if(this.options.addressValidation){b('<div style="clear:both;"></div>').appendTo(this.fieldContainer);b('<div class="alpaca-form-button">Google Map</div>').appendTo(this.fieldContainer).button({text:true}).click(function(){if(google&&google.maps){var f=new google.maps.Geocoder();var e=d.getAddress();if(f){f.geocode({address:e},function(j,h){if(h==google.maps.GeocoderStatus.OK){var i=d.getId()+"-map-canvas";if(b("#"+i).length==0){b("<div id='"+i+"' class='alpaca-controlfield-address-mapcanvas'></div>").appendTo(d.fieldContainer)}var k=new google.maps.Map(document.getElementById(d.getId()+"-map-canvas"),{zoom:10,center:j[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP});var g=new google.maps.Marker({map:k,position:j[0].geometry.location})}else{d.displayMessage("Geocoding failed: "+h)}})}}else{d.displayMessage("Google Map API is not installed.")}}).wrap("<small/>")}if(c){c()}},isContainer:function(){return false},getSchemaOfOptions:function(){return a.merge(this.base(),{properties:{validateAddress:{title:"Address Validation",description:"Enable address validation if true",type:"boolean","default":true}}})},getOptionsForOptions:function(){return a.merge(this.base(),{fields:{validateAddress:{helper:"Address validation if checked",rightLabel:"Enable Google Map for address validation?",type:"checkbox"}}})},getTitle:function(){return"Address"},getDescription:function(){return"Standard US Address with Street, City, State and Zip. Also comes with support for Google map."},getType:function(){return"any"},getFieldType:function(){return"address"}});a.registerFieldClass("address",a.Fields.AddressField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.PrintButtonField=a.Fields.ButtonField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("print")}},onClick:function(c){this.form.topControl.print()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-print");if(this.field.button){this.field.button({text:true,icons:{primary:"ui-icon-print"}})}},getTitle:function(){return"Alpaca Screen Print Button"},getDescription:function(){return"Alpaca button for screen printing."}});a.registerMessages({print:"Print Screen"});a.registerFieldClass("printbutton",a.Fields.PrintButtonField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.ReloadButtonField=a.Fields.ButtonField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("reload")}},onClick:function(c){this.form.topControl.reload()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-reload");if(this.field.button){this.field.button({text:true,icons:{primary:"ui-icon-refresh"}})}},getTitle:function(){return"Alpaca Reload Button"},getDescription:function(){return"Alpaca button for reloading data."}});a.registerMessages({reload:"Reload"});a.registerFieldClass("reloadbutton",a.Fields.ReloadButtonField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.SwitchViewButtonField=a.Fields.ButtonField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();if(!this.data){this.data=this.view.getMessage("switchView")}},switcherPaneShow:function(){var c=this;this.switcherPane.css({}).slideDown(50)},switcherPaneHide:function(){this.switcherPane.slideUp(50,function(){})},onClick:function(f){var i=this.form.topControl.view.viewObject;if(a.isEmpty(this.viewList)){if(a.isEmpty(a.views[i.id])){if(a.isEmpty(i.id)){i.id=a.generateViewId()}if(a.isEmpty(i.description)){i.title=this.view.getMessage("currentView")}a.registerView(i)}var d=[];for(var c in a.views){d.push({id:c,desc:a.views[c].title})}this.viewList=d}var h='<div class="ui-widget ui-widget-content ui-corner-all alpaca-form-button-view-switcher"><div class="ui-state-highlight"><ul>';b.each(this.viewList,function(e,j){h+='<li><a href="#" id="'+j.id+'"';if(j.id==i.id||j.id==i){h+=' class="current"'}h+=">"+j.desc+"</a></li>"});h+="</url></div></div>";this.switcherPane=b(h);var g=this;this.switcherPane.find("a").click(function(){var e=b(this).attr("id");g.form.topControl.initializing=true;g.form.topControl.render(e);g.switcherPaneHide();return false});this.switcherPane.click(function(){if(g.switcherPane.is(":visible")){g.switcherPaneHide()}});this.fieldContainer.append(this.switcherPane.hide());this.switcherPaneShow()},postRender:function(){this.base();this.field.addClass("alpaca-form-button-switchview");this.button=this.field.button({text:true,icons:{primary:"ui-icon-shuffle"}})},getTitle:function(){return"Alpaca Switch View Button"},getDescription:function(){return"Alpaca button for switching views."}});a.registerMessages({switchView:"Switch View",currentView:"Current Custom View"});a.registerFieldClass("switchviewbutton",a.Fields.SwitchViewButtonField)})(jQuery);(function(b){var a=b.alpaca;a.Fields.SaveButtonField=a.Fields.ButtonField.extend({constructor:function(e,i,g,h,d,c,f){this.base(e,i,g,h,d,c,f)},setup:function(){this.base();this.buttonType="button";if(!this.data){this.data=this.view.getMessage("save")}},onClick:function(g){var h=this;var f=this.form.topControl;var d=f.getValue();if(a.isEmpty(f.data)){f.data={}}a.mergeObject(f.data,d);var c=f.connector;c.saveData({data:f.data,schema:f.schema},function(e){a.merge(f.data,e);if(h.success&&a.isFunction(h.success)){h.success(f.data)}else{alert("Data Saved!")}},function(e){if(h.error&&a.isFunction(h.error)){h.error(e)}else{alert(e)}})},postRender:function(){this.base();this.field.addClass("alpaca-form-button-save");this.field.button({text:true,icons:{primary:"ui-icon-disk"}})},getTitle:function(){return"Save Button"},getDescription:function(){return"Button for storing data."}});a.registerMessages({save:"Save"});a.registerFieldClass("savebutton",a.Fields.SaveButtonField)})(jQuery);(function(b){var a=b.alpaca;a.registerView({id:"VIEW::WEB_EDIT",messages:{zh_CN:{required:"&#27492;&#22495;&#24517;&#39035;",invalid:"&#27492;&#22495;&#19981;&#21512;&#26684;",months:["&#19968;&#26376;","&#20108;&#26376;","&#19977;&#26376;","&#22235;&#26376;","&#20116;&#26376;","&#20845;&#26376;","&#19971;&#26376;","&#20843;&#26376;","&#20061;&#26376;","&#21313;&#26376;","&#21313;&#19968;&#26376;","&#21313;&#20108;&#26376;"],timeUnits:{SECOND:"&#31186;",MINUTE:"&#20998;",HOUR:"&#26102;",DAY:"&#26085;",MONTH:"&#26376;",YEAR:"&#24180;"},notOptional:"&#27492;&#22495;&#38750;&#20219;&#36873;",disallowValue:"&#38750;&#27861;&#36755;&#20837;&#21253;&#25324; {0}.",invalidValueOfEnum:"&#20801;&#35768;&#36755;&#20837;&#21253;&#25324; {0}.",notEnoughItems:"&#26368;&#23567;&#20010;&#25968; {0}",tooManyItems:"&#26368;&#22823;&#20010;&#25968; {0}",valueNotUnique:"&#36755;&#20837;&#20540;&#19981;&#29420;&#29305;",notAnArray:"&#19981;&#26159;&#25968;&#32452;",invalidDate:"&#26085;&#26399;&#26684;&#24335;&#22240;&#35813;&#26159; {0}",invalidEmail:"&#20234;&#22969;&#20799;&#26684;&#24335;&#19981;&#23545;, ex: admin@gitanasoftware.com",stringNotAnInteger:"&#19981;&#26159;&#25972;&#25968;.",invalidIPv4:"&#19981;&#26159;&#21512;&#27861;IP&#22320;&#22336;, ex: 192.168.0.1",stringValueTooSmall:"&#26368;&#23567;&#20540;&#26159; {0}",stringValueTooLarge:"&#26368;&#22823;&#20540;&#26159; {0}",stringValueTooSmallExclusive:"&#20540;&#24517;&#39035;&#22823;&#20110; {0}",stringValueTooLargeExclusive:"&#20540;&#24517;&#39035;&#23567;&#20110; {0}",stringDivisibleBy:"&#20540;&#24517;&#39035;&#33021;&#34987; {0} &#25972;&#38500;",stringNotANumber:"&#19981;&#26159;&#25968;&#23383;.",invalidPassword:"&#38750;&#27861;&#23494;&#30721;",invalidPhone:"&#38750;&#27861;&#30005;&#35805;&#21495;&#30721;, ex: (123) 456-9999",invalidPattern:"&#27492;&#22495;&#39035;&#26377;&#26684;&#24335; {0}",stringTooShort:"&#27492;&#22495;&#33267;&#23569;&#38271;&#24230; {0}",stringTooLong:"&#27492;&#22495;&#26368;&#22810;&#38271;&#24230; {0}"},es_ES:{required:"Este campo es required",invalid:"Este campo es invlido",months:["Enero","Febrero","Marzo","Abril","Puede","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],timeUnits:{SECOND:"segundos",MINUTE:"minutos",HOUR:"horas",DAY:"das",MONTH:"meses",YEAR:"aos"},notOptional:"Este campo no es opcional.",disallowValue:"{0} son los valores rechazados.",invalidValueOfEnum:"Este campo debe tener uno de los valores adentro {0}.",notEnoughItems:"El nmero mnimo de artculos es {0}",tooManyItems:"El nmero mximo de artculos es {0}",valueNotUnique:"Los valores no son nicos",notAnArray:"Este valor no es un arsenal",invalidDate:"Fecha invlida para el formato {0}",invalidEmail:"Email address invlido, ex: admin@gitanasoftware.com",stringNotAnInteger:"Este valor no es un nmero entero.",invalidIPv4:"Direcci&#243;n invlida IPv4, ex: 192.168.0.1",stringValueTooSmall:"El valor mnimo para este campo es {0}",stringValueTooLarge:"El valor mximo para este campo es {0}",stringValueTooSmallExclusive:"El valor de este campo debe ser mayor que {0}",stringValueTooLargeExclusive:"El valor de este campo debe ser menos que {0}",stringDivisibleBy:"El valor debe ser divisible cerca {0}",stringNotANumber:"Este valor no es un nmero.",invalidPassword:"Contrasea invlida",invalidPhone:"Nmero de telfono invlido, ex: (123) 456-9999",invalidPattern:"Este campo debe tener patr&#243;n {0}",stringTooShort:"Este campo debe contener por lo menos {0} nmeros o caracteres",stringTooLong:"Este campo debe contener a lo ms {0} nmeros o caracteres"}}})})(jQuery);(function(b){var a=b.alpaca;a.Connector=Base.extend({constructor:function(d,c){this.id=d;this.configs=c},connect:function(d,c){if(d&&a.isFunction(d)){d()}},loadTemplate:function(e,d,c){if(!a.isEmpty(e)){if(a.isUri(e)){this.loadUri(e,false,function(f){if(d&&a.isFunction(d)){d(f)}},function(f){if(c&&a.isFunction(c)){c(f)}})}else{d(e)}}else{c({message:"Empty data source.",reason:"TEMPLATE_LOADING_ERROR"})}},loadData:function(h,d,e){var g=h.data;var f=h.schema;var c=function(){return !a.isEmpty(g)&&a.isUri(g)&&(!(f&&f.format&&f.format=="uri"))};if(c()){this.loadJson(g,function(i){h.data=i;d(h)},e)}else{d(h)}},loadSchema:function(g,c,d){var f=g.schema;var e=function(){return !a.isEmpty(f)&&a.isUri(f)};if(e()){this.loadJson(f,function(h){g.schema=h;c(g)},d)}else{c(g)}},loadOptions:function(g,c,d){var e=g.options;var f=function(){return !a.isEmpty(e)&&a.isUri(e)};if(f()){this.loadJson(e,function(h){g.options=h;c(g)},d)}else{c(g)}},loadView:function(g,c,e){var d=g.view;var f=function(){return !a.isEmpty(d)&&a.isUri(d)};if(f()){this.loadJson(d,function(h){g.view=h;c(g)},e)}else{c(g)}},loadAll:function(c,j,i){var d=0;var g=c.data;var l=c.options;var f=c.schema;var k=c.view;var e=function(m){d++;if(d==4){if(j&&a.isFunction(j)){j(m.data,m.options,m.schema,m.view)}}};var h=function(m){if(i&&a.isFunction(i)){i(m)}};this.loadData(c,e,h);this.loadSchema(c,e,h);this.loadOptions(c,e,h);this.loadView(c,e,h)},saveData:function(d,e,c){},loadJson:function(d,e,c){this.loadUri(d,true,e,c)},loadUri:function(e,c,g,d){var f={url:e,type:"get",success:function(h){if(g&&a.isFunction(g)){g(h)}},error:function(h,j,i){if(d&&a.isFunction(d)){d({message:"Unable to load data from uri : "+e,stage:"DATA_LOADING_ERROR",details:{jqXHR:h,textStatus:j,errorThrown:i}})}}};if(c){f.dataType="json"}else{f.dataType="text"}b.ajax(f)}});a.registerConnectorClass("default",a.Connector)})(jQuery);(function(b){var a=b.alpaca;a.Connectors.SimpleConnector=a.Connector.extend({constructor:function(d,c){this.base(d,c);this.root=this.configs.root?this.configs.root:"/";if(!a.endsWith(this.root,"/")){this.root=this.root+"/"}this.prefixMappings={data:this.root+"data",schema:this.root+"schema",options:this.root+"forms",view:this.root+"views",template:this.root+"templates"};this.postfixMappings={data:".json",schema:".json",options:".json",view:".json",template:".tmpl"}},connect:function(d,c){this.base(d,c)},loadData:function(i,d,e){var j=this;var h=this.base;var g=i.data;var c=function(){return !a.isEmpty(g)&&a.isString(g)&&!a.isUri(g)};if(c()){var f=this.prefixMappings.data+"/"+g+this.postfixMappings.data;this.loadUri(f,true,function(k){i.data=k;d(i)},function(k){h(i,function(l){d(l)},function(l){e(l)})})}else{this.base(i,function(k){d(k)},function(k){e(k)})}},loadView:function(i,c,e){var j=this;var h=this.base;var d=i.view;var g=function(){return !a.isEmpty(d)&&a.isString(d)&&!a.isUri(d)&&!a.isValidViewId(d)};if(g()){var f=this.prefixMappings.view+"/"+this.originalDataSource.schema+"-"+this.originalDataSource.options+"-"+d+this.postfixMappings.view;this.loadUri(f,true,function(k){i.view=k;j.loadData(i,c,e)},function(k){h(i,function(l){j.loadData(l,c,e)},function(l){j.loadData(i,c,e)})})}else{this.base(i,function(k){j.loadData(k,c,e)},function(k){j.loadData(i,c,e)})}},loadOptions:function(i,c,d){var j=this;var h=this.base;var e=i.options;var g=function(){return !a.isEmpty(e)&&a.isString(e)&&!a.isUri(e)};if(g()){var f=this.prefixMappings.options+"/"+this.originalDataSource.schema+"-"+e+this.postfixMappings.options;this.loadUri(f,true,function(k){i.options=k;j.loadView(i,c,d)},function(k){h(i,function(l){j.loadView(l,c,d)},function(l){j.loadView(i,c,d)})})}else{this.base(i,function(k){j.loadView(k,c,d)},function(k){j.loadView(i,c,d)})}},loadSchema:function(i,c,d){var j=this;var h=this.base;var g=i.schema;var e=function(){return !a.isEmpty(g)&&a.isString(g)&&!a.isUri(g)};if(e()){var f=this.prefixMappings.schema+"/"+g+this.postfixMappings.schema;this.loadUri(f,true,function(k){i.schema=k;j.loadOptions(i,c,d)},function(k){h(i,function(l){j.loadOptions(l,c,d)},function(l){j.loadOptions(i,c,d)})})}else{this.base(i,function(k){j.loadOptions(k,c,d)},function(k){j.loadOptions(i,c,d)})}},loadAll:function(c,j,i){var d=0;var g=c.data;var l=c.options;var f=c.schema;var k=c.view;this.originalDataSource=a.cloneObject(c);var e=function(m){if(j&&a.isFunction(j)){j(m.data,m.options,m.schema,m.view)}};var h=function(m){if(i&&a.isFunction(i)){i(m)}};this.loadSchema(c,e,h)},loadTemplate:function(g,f,d){var h=this;var e=this.base;if(a.isString(g)&&!a.isUri(g)&&!a.isValidViewId(g)&&g.match(/^[a-zA-Z0-9_\s-]+$/)){var c=g=this.prefixMappings.template+"/"+g+this.postfixMappings.template;h.loadUri(c,false,function(i){g=i;e(g,f,d)},function(i){e(g,f,d)})}else{e(g,f,d)}}});a.registerConnectorClass("simple",a.Connectors.SimpleConnector)})(jQuery);(function(b){var a=b.alpaca;a.Connectors.GitanaConnector=a.Connector.extend({constructor:function(d,c){this.base(d,c);this.gitanaNodes={};this.gitanaContext=c.gitanaContext},connect:function(d,c){this.base(d,c)},saveData:function(i,h,f){var j=this;var g=i.data;var c=function(k){if(j.isInvalidTicketError(k)){j.gitanaContext.init().then(function(){j.saveData(i,h,f)})}else{if(f&&a.isFunction(f)){f({message:"Gitana Connector Error : "+k.message,reason:"GITANA_SAVE_ERROR",details:{error:k}})}}};var d=this.getGitanaNode(g);if(!a.isEmpty(d)){a.mergeObject(d.object,g);d.trap(function(k){c(k)}).update().reload().then(function(){j.gitanaNodes[d.getId()]=this;i.data=this.object;if(h){h(this.object)}})}else{var e=i.schema;if(!a.isEmpty(e)&&!a.isEmpty(e._qname)){g._type=e._qname}this.gitanaContext.then(function(){this.branch().trap(function(k){c(k)}).createNode(g).then(function(){j.gitanaNodes[d.getId()]=this;i.data=this.object;if(h){h(this.object)}})})}},loadData:function(i,d,e){var j=this;var h=this.base;var g=i.data;var f=this.branch;var c=function(){return !a.isEmpty(g)&&a.isString(g)&&!a.isUri(g)&&(j.isValidGitanaId(g)||j.isValidQName(g))};if(c()){this.gitanaContext.then(function(){this.branch().trap(function(k){e(k)}).readNode(g).then(function(){j.gitanaNodes[this.getId()]=this;i.data=this.object;i.data.attachments={};this.listAttachments().each(function(){i.data.attachments[this.getId()]=this.getDownloadUri()}).then(function(){d(i)})})})}else{this.base(i,function(k){d(k)},function(k){e(k)})}},loadView:function(i,c,e){var j=this;var h=this.base;var d=i.view;var g=this.branch;var f=function(){return !a.isEmpty(d)&&a.isString(d)&&!a.isUri(d)&&!a.isValidViewId(d)};if(f()){this.loadData(i,c,e)}else{this.base(i,function(k){j.loadData(k,c,e)},function(k){e(k)})}},loadOptions:function(c,e,g){var h=this;var d=this.base;var f=c.schemaNode;var k=c.options;var j=this.branch;var i=function(){return !a.isEmpty(f)&&!a.isEmpty(k)&&a.isString(k)&&!a.isUri(k)};if(i()){if(f){f.trap(function(l){g(l)}).readForm(k).then(function(){c.optionsNode=this;c.options=this.object;h.gitanaNodes[this.getId()]=this;h.loadView(c,e,g)})}else{d(c,function(l){h.loadView(l,e,g)},function(l){g(l)})}}else{this.base(c,function(l){h.loadView(l,e,g)},function(l){g(l)})}},loadSchema:function(i,c,d){var j=this;var h=this.base;var g=i.schema;var f=this.branch;var e=function(){return !a.isEmpty(g)&&a.isString(g)&&!a.isUri(g)&&(j.isValidGitanaId(g)||j.isValidQName(g))};if(e()){this.gitanaContext.then(function(){this.branch().trap(function(k){d(k)}).readDefinition(g).then(function(){i.schemaNode=this;i.schema=this.object;j.gitanaNodes[this.getId()]=this;j.loadOptions(i,c,d)})})}else{this.base(i,function(k){j.loadOptions(k,c,d)},function(k){d(k)})}},loadAll:function(g,f,e){var h=this;var c=function(i){if(f&&a.isFunction(f)){f(i.data,i.options,i.schema,i.view)}};var d=function(i){if(h.isInvalidTicketError(i)){h.gitanaContext.init().then(function(){h.loadAll(g,f,e)})}else{if(e&&a.isFunction(e)){e({message:"Gitana Connector Error : "+i.message,reason:"GITANA_LOAD_ERROR",details:{error:i}})}}};this.loadSchema(g,c,d)},loadTemplate:function(e,d,c){this.base(e,d,c)},isValidQName:function(c){return !a.isEmpty(c)&&a.isString(c)&&c.match(/^[0-9a-zA-Z-_]+:[0-9a-zA-Z-_]+$/)},isValidGitanaId:function(c){return !a.isEmpty(c)&&a.isString(c)&&c.match(/^[0-9a-z]{32}$/)},isInvalidTicketError:function(c){return c.http&&c.http.status&&c.http.status==403&&c.http.reason=="INVALID_TICKET"},getGitanaNode:function(c){if(this.gitanaNodes&&c&&this.gitanaNodes[c._doc]){return this.gitanaNodes[c._doc]}}});a.registerConnectorClass("gitana",a.Connectors.GitanaConnector)})(jQuery);